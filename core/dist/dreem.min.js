/*
 * The MIT License (MIT)
 *
 * Copyright ( c ) 2015 Teem2 LLC
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
(function(){var t,e,n=[].slice,i={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e={bold:"fontWeight",bordercolor:"borderColor",borderstyle:"borderStyle",bottomborder:"borderBottomWidth",bottompadding:"paddingBottom",boxshadow:"boxShadow",bgcolor:"backgroundColor",ellipsis:"textOverflow",fontfamily:"fontFamily",fontweight:"fontWeight",fontsize:"fontSize",italic:"fontStyle",leftborder:"borderLeftWidth",leftpadding:"paddingLeft",rightborder:"borderRightWidth",rightpadding:"paddingRight",smallcaps:"fontVariant",topborder:"borderTopWidth",toppadding:"paddingTop",visible:"visibility",whitespace:"whiteSpace",x:"marginLeft",y:"marginTop",z:"z-index"},t=function(){var t,n,i,r,s;t={};for(i in e)s=e[i],t[s]=i;return n=$.style,r=function(e,i,r){var s,o;return s=t[i],null==s&&(s=t[i.replace(/-([a-z])/i,function(t){return t[1].toUpperCase()})],s=t[i]=s?s:i),s&&(o=e.$view,o[s]!==r&&o.setAttribute(s,r)),n.apply(this,arguments)},function(t){return $.style=t?r:n}}.call(this),window.dr=function(){var t,i,o,u,a,l,h,p,d,c,f,g,v,_,y,b,m,w,x,k,A,S,T,E,F,H,M,L,O,C,z,B,P,N,R,I,j,W,D,V,q,X,Y,K,U,G,J,Z,Q;return u=window.Node.COMMENT_NODE,V=function(){},F=function(t,e,n){return n||(n=.01),Math.abs(t-e)<n},W=function(){var t,e,i,s,o,u,a,l,h;for(e=arguments[0],u=2<=arguments.length?n.call(arguments,1):[],t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e}(e),i=l=u.length-1;l>=0;i=l+=-1){o=u[i],h=o.prototype;for(a in h)s=h[a],t.prototype[a]=s}return t},j=/%$/,h=function(){var t,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};return t={triggerlock:null,register:function(t,e){var n,i,r,s,o;for(n=t.split(" "),this.hasOwnProperty("events")&&this.events||(this.events={}),s=0,o=n.length;o>s;s++)i=n[s],(r=this.events)[i]||(r[i]=[]),this.events[i].push(e);return this},one:function(t,e){return this.register(t,function(){return this.unregister(t,arguments.callee),e.apply(this,arguments)}),this},trigger:function(t,n,i){var r,s,o,u,a;if(s=this.hasOwnProperty("events")&&(null!=(a=this.events)?a[t]:void 0)){if(this.triggerlock){if(e.call(this.triggerlock,t)>=0)return this;this.triggerlock.push(t)}else this.triggerlock=[t];for(o=0,u=s.length;u>o;o++)r=s[o],r.call(this,n,i);return this.triggerlock=null,this}},listenTo:function(t,e,n){return t.register(e,n),this.listeningTo||(this.listeningTo=[]),this.listeningTo.push({obj:t,ev:e,callback:n}),this},listenToOnce:function(t,e,n){var i;return i=this.listeningToOnce||(this.listeningToOnce=[]),i.push(t),t.one(e,function(){var e;return e=i.indexOf(t),-1!==e&&i.splice(e,1),n.apply(this,arguments)}),this},stopListening:function(t,e,n){var i,r,s,o,u,a,l,h,p,d,c,f,g;if(t){for(t.unregister(e,n),c=[this.listeningTo,this.listeningToOnce],u=0,h=c.length;h>u;u++)if(s=c[u])if(i=s.indexOf(t),i>-1)s.splice(i,1);else for(r=a=0,p=s.length;p>a;r=++a)if(o=s[r],t===o.obj&&e===o.ev&&n===o.callback){s.splice(r,1);break}}else{for(f=this.listeningTo,l=0,d=f.length;d>l;l++)g=f[l],t=g.obj,e=g.ev,n=g.callback,t.unregister(e,n);this.listeningTo=void 0}return this},unregister:function(t,e){var n,i,r,s,o,u,a,l,h,p;if(!t)return this.events={},this;for(i=t.split(" "),u=0,l=i.length;l>u;u++)if(o=i[u],s=null!=(p=this.events)?p[o]:void 0)if(e){for(r=a=0,h=s.length;h>a;r=++a)if(n=s[r],n===e){s=s.slice(),s.splice(r,1),this.events[o]=s;break}}else delete this.events[o];return this}}}.call(this),g=function(){var t,e,n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};return e=["included","extended"],t=function(){function t(){}return t.include=function(t){var i,r,s;if(!t)throw new Error("include(obj) requires obj");for(i in t)r=t[i],n.call(e,i)<0&&(this.prototype[i]=r);return null!=(s=t.included)&&s.call(this,t),this},t}()}.call(this),N={parent:!0,id:!0,name:!0,"extends":!0,type:!0,scriptincludes:!0},l=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}var i;return n(e,t),e.include(h),i={number:parseFloat,"boolean":function(t){return"string"==typeof t?"true"===t:!!t},string:function(t){return t+""},json:function(t){return JSON.parse(t)},expression:function(t){return"string"!=typeof t?t:H.compile("return "+t)()},positivenumber:function(t){return t=parseFloat(t),isNaN(t)?0:Math.max(0,t)},emptynumber:function(t){return null==t||""===t?"":parseFloat(t)},size:function(t){return j.test(t)||"auto"===t?t:(t=parseFloat(t),isNaN(t)?0:Math.max(0,t))},x:function(t){var e;if(j.test(t))return t;if("string"==typeof t)switch(e=t.toLowerCase()){case"begin":case"middle":case"end":case"left":case"right":case"center":case"none":return e;default:t=parseFloat(t)}return isNaN(t)?(t=this.x,isNaN(t)?0:t):t},y:function(t){var e;if(j.test(t))return t;if("string"==typeof t)switch(e=t.toLowerCase()){case"begin":case"middle":case"end":case"top":case"bottom":case"center":case"none":return e;default:t=parseFloat(t)}return isNaN(t)?(t=this.y,isNaN(t)?0:t):t}},e.prototype._coerceType=function(t,e,n){var r;if(n||(n=this.types[t]),n){if(L||G){if(!i[n])return void X(["Invalid type '"+n+"' for attribute '"+t+"', must be one of: "+Object.keys(i).join(", ")]);try{e=i[n].call(this,e)}catch(s){r=s,X(["error parsing "+n+" value '"+e+"' for attribute '"+t+"'"])}}else e=i[n].call(this,e);"number"===n&&isNaN(e)&&(e=this[t],isNaN(e)&&(e=0))}else null==e&&(e="");return e},e.prototype.setAttribute=function(t,e,n){var i;return e=this._coerceType(t,e),n||this._unbindConstraint(t),i="set_"+t,"function"==typeof this[i]&&(e=this[i](e),e===V)?this:(t in N?this.setAndFire(t,e):this.defaultSetAttributeBehavior(t,e),this)},e.prototype.defaultSetAttributeBehavior=function(t,e){return this.setAndFire(t,e)},e.prototype.setAndFire=function(t,e){return this.sendEvent(t,this[t]=e)},e.prototype.sendEvent=function(t,e){var n;return R?void C.push({scope:this,name:t,value:e}):((null!=(n=this.events)?n[t]:void 0)&&this.trigger(t,e,this),this)},e.prototype.setAttributes=function(t){var e,n;for(e in t)n=t[e],this.setAttribute(e,n);return this},e}(g)}.call(this),T=function(){return{localStorage:function(){var t,e;e="dr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(n){return t=n,!1}}(),touch:"ontouchstart"in window||"onmsgesturechange"in window,camelcss:navigator.userAgent.toLowerCase().indexOf("firefox")>-1,raf:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,prefix:function(){var t,e,n;return n=window.getComputedStyle(document.documentElement,""),e=(Array.prototype.slice.call(n).join("").match(/-(moz|webkit|ms)-/)||""===n.OLink&&["","o"])[1],t="WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1],{dom:t,lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}}()}}.call(this),q=window.location.search,L=q.indexOf("debug")>0,G=q.indexOf("test")>0,H=function(){var t,e,n,i,r,s,o,u,a,l,h;return o=q.indexOf("nocache")>0,a=q.indexOf("strict")>0,o||(h=T.localStorage),e="dreemcache",t=localStorage.getItem(e),h&&t&&t.length<5e6?i=JSON.parse(t):(localStorage.clear(),i={bindings:{},script:{coffee:{}}},h&&(localStorage[e]=JSON.stringify(i))),window.addEventListener("unload",function(){return h?localStorage[e]=JSON.stringify(i):void 0}),s=function(){var t,e,n;return t=i.bindings,n=null,e={MemberExpression:function(t,e){var i;return"CallExpression"===e.node.type&&"callee"===e.sub?!0:(i=t.property.name,t=t.object,n.push({binding:acorn.stringify(t),property:i}),!0)}},function(i){var r;return h&&i in t?t[i]:(r=acorn.parse(i),n=[],acorn.walkDown(r,e),t[i]=n)}}(),l=function(){var t,e;return t=i.script.coffee,e={coffee:function(e){var n;if(h&&e in t)return t[e];if(!window.CoffeeScript)return void console.warn("missing coffee-script.js include");try{if(e)return t[e]=CoffeeScript.compile(e,{bare:!0})}catch(i){return n=i,X(["error "+n+" compiling script\r\n"+e])}}},function(t,n){return null==t&&(t=""),n in e?e[n](t):t}}(),u={},r=function(t,e,n){var i,r,s,o;if(null==t&&(t=""),null==e&&(e=[]),null==n&&(n=""),i=e.join(),o=t+i+n,o in u)return u[o];try{return a&&(t='"use strict"\n'+t),s=n?new Function("return function "+n.replace("-","_")+"("+i+"){"+t+"}")():new Function(e,t),u[o]=s}catch(l){return r=l,X(["Failed to compile "+r.toString()+" "+e+" "+t])}},n=function(t,e,n){var i,r;return null==t&&(t=""),null==e&&(e=[]),null==n&&(n=""),i=e.join(),r=t+i+n,r in u?u[r]:u[r]=new Function(e,t)},{compile:L?r:n,transform:l,findBindings:s}}.call(this),M=[],R=!1,B=[],C=[],Z=function(){var t,e,n,i,r,s,o,u,a,l;for(R=!1,r=0,u=B.length;u>r;r++)n=B[r],n._bindHandlers();for(B=[],s=0,a=C.length;a>s;s++)t=C[s],n=t.scope,e=t.name,i=t.value,"init"===e&&(n.inited=!0),n.sendEvent(e,i);for(C=[],o=0,l=M.length;l>o;o++)n=M[o],n._bindConstraints();return M=[]},E=function(t){var e,n,i;n={};for(e in t)i=t[e],n[e]=i;return n},Q=function(t,e){var n,i,r,s,o,u,a,l,h,p;if(null!=t["with"])for(s=t["with"].split(",").reverse(),l=0,h=s.length;h>l;l++)r=s[l],i=dr[r.trim()],i&&Q(i.classattributes,e);p=[];for(n in t)a=t[n],"with"!==n&&(("$methods"===n||"$types"===n)&&n in e?(e[n]=E(e[n]),p.push(function(){var t;t=[];for(o in a)u=a[o],t.push("$methods"===n&&e[n][o]?e[n][o]=e[n][o].concat(u):e[n][o]=u);return t}())):p.push("$handlers"===n&&n in e?e[n]=e[n].concat(a):e[n]=a));return p},_=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},r=[].slice;return t=function(t){function e(t,e){var n,i,r,o,u,a,l,p,c,f,g,v,_;if(null==e&&(e={}),null!=e["with"]&&(null==e.$tagname&&(p=!0),l={},Q(e,l),e=l,p&&delete e.$tagname),a=e.$methods)for(c=0,g=s.length;g>c;c++)if(o=s[c],u=a[o])for(f=0,v=u.length;v>f;f++)_=u[f],r=_.method,n=_.args,i=h.test(r),d(this,o,H.compile(r,n,""+e.$tagname+"$"+o).bind(this),i);this.construct(t,e)}var s,o,u,a,h,p,d;return n(e,t),o=["name","parent"],u=["data","skin"],s=["construct","createSprite"],e.prototype.createChild=function(t,e){var n,i,r;return null==t&&(t={}),null==e&&(e=!1),n=null!=(r=t["class"])?r:"node",delete t["class"],"function"!=typeof dr[n]?void X(["Unrecognized class "+n+" in createChild()"]):(i=t.element,delete t.element,null==t.parent&&(t.parent=this),new dr[n](i,t,e))},e.prototype.construct=function(t,n){var r,s,a,l,h,p,d,c,f,g,v,_,y,b,m,w,x,k;if(this.subnodes=[],this.types=null!=(b=n.$types)?b:{},delete n.$types,l=n.$skiponinit,delete n.$skiponinit,r=n.$deferbindings,delete n.$deferbindings,null!=t&&(t.$view=this,n.$textcontent=t.textContent),h=n.$tagname,n.$methods&&(this.installMethods(n.$methods,h),delete n.$methods),n.$handlers){if(this.installHandlers(n.$handlers,h),"false"!==n.clickable)for(m=function(){var t,e,r,o,u;for(r=n.$handlers,u=[],t=0,e=r.length;e>t;t++)s=r[t],o=s.ev.substr(2),i.call(D,o)>=0&&u.push(s);return u}(),p=0,g=m.length;g>p;p++){s=m[p],n.clickable=!0;break}delete n.$handlers}r||this._bindHandlers(),w=function(){var t,e,i;for(i=[],t=0,e=o.length;e>t;t++)s=o[t],s in n&&i.push(s);return i}();for(d=0,v=w.length;v>d;d++)s=w[d],this.setAttribute(s,n[s]);for(x=function(){var t;t=[];for(s in n)i.call(u,s)>=0||i.call(o,s)>=0||t.push(s);return t}(),c=0,_=x.length;_>c;c++)s=x[c],this.bindAttribute(s,n[s],h);a=this.parent,a&&a instanceof e&&(a.sendEvent("subnodes",this),a.doSubnodeAdded(this)),k=function(){var t,e,i;for(i=[],e=0,t=u.length;t>e;e++)s=u[e],s in n&&i.push(s);return i}();for(f=0,y=k.length;y>f;f++)s=k[f],this.bindAttribute(s,n[s],h);return this.constraints&&M.push(this),l||this.inited?void 0:this.initialize()},e.prototype.initialize=function(t){return R||(this.inited=!0),t?void 0:this.sendEvent("init",this)},h=/this.super\(|this\["super"\]\(/,e.prototype.installMethods=function(t,e,n,r){var o,u,a,l,p,c,f,g,v;null==n&&(n=this),null==r&&(r=this);for(c in t)for(p=t[c],f=0,g=p.length;g>f;f++)v=p[f],l=v.method,u=v.args,o=v.allocation,i.call(s,c)>=0||(a=h.test(l),d(n,c,H.compile(l,u,""+e+"$"+c).bind(r),a,o))},e.prototype.installHandlers=function(t,e,n){var i,r,s,o,u,a,l,h,d,c;for(null==n&&(n=this),null==this.handlers&&(this.handlers=[]),d=0,c=t.length;c>d;d++)s=t[d],r=s.ev,a=s.name,h=s.script,i=s.args,l=s.reference,u=s.method,r=r.substr(2),s.callback=u?n[u]:p(r,h,n,e,i),o={scope:this,ev:r,name:a,callback:s.callback,reference:l},this.handlers.push(o)},e.prototype.removeHandlers=function(t,e,n){var i,r,s,o,u,a,l,h,p,d;for(null==n&&(n=this),p=0,d=t.length;d>p;p++)s=t[p],r=s.ev,u=s.name,h=s.script,i=s.args,a=s.reference,o=s.method,r=r.substr(2),null!=a?(l=this._valueLookup(a)(),n.stopListening(l,r,s.callback)):n.unregister(r,s.callback)},a=/\${(.+)}/,e.prototype.bindAttribute=function(t,e,n){var i,r,s;return"string"==typeof e&&(i=e.match(a))?this.setConstraint(t,i[1],!0):(r=t.match(I))?(t=r[1],s={scope:this,ev:t,callback:p(t,e,this,n)},this.handlers.push(s)):this.setAttribute(t,e)},p=function(t,e,n,i,r){var s;return null==i&&(i=""),null==r&&(r=["value"]),s=H.compile(e,r,""+i+"$on"+t),function(){var e;return e=arguments.length?arguments:t in n?[n[t]]:[],s.apply(n,e)}},d=function(t,e,n,i){var s,o;return i?(e in t&&"function"==typeof t[e]&&(o=t[e],s=!0),t[e]=function(){var e,i,u,a;return e=1<=arguments.length?r.call(arguments,0):[],i=t.hasOwnProperty("super"),i&&(u=t["super"]),t["super"]=s?function(){var n,i,s;for(s=1<=arguments.length?r.call(arguments,0):[],n=s.length,i=e.splice(0);n;)i[--n]=s[n];return o.apply(t,i)}:V,a=n.apply(t,e),i?t["super"]=u:delete t["super"],a}):t[e]=n},e.prototype.setConstraint=function(t,e,n){var i,r,s,o,u,a;for(null!=this.constraints?this._unbindConstraint(t):this.constraints={},this.constraints[t]={expression:e,bindings:{}},r=this.constraints[t].bindings,o=H.findBindings(e),u=0,a=o.length;a>u;u++)s=o[u],i=s.binding,null==r[i]&&(r[i]=[]),r[i].push(s);n||this._bindConstraints()},e.prototype._valueLookup=function(t){return H.compile("return "+t).bind(this)},e.prototype._unbindConstraint=function(t){var e,n,i,r,s,o,u,a,l;if(this.constraints&&(null!=(a=this.constraints[t])?a.callback:void 0)){for(l=this.constraints[t],e=l.callback,n=l.callbackbindings,i=o=0,u=n.length;u>o;i=o+=2)r=n[i],s=n[i+1],s.unregister(r,e);this.constraints[t]=null}},e.prototype._bindConstraints=function(){var t,e,n,i,r,s,o,u,a,h,p,d,c;c=this.constraints;for(a in c){s=c[a],i=s.bindings,o=s.expression,null==s.callbackbindings&&(s.callbackbindings=[]),u=this._valueLookup(o),s.callback=this._constraintCallback(a,u);for(t in i)if(n=i[t],r=this._valueLookup(t)())for(r instanceof l||console.log("Binding to non-Eventable "+t+" of constraint "+o+" for "+this.$tagname+(this.id?"#"+this.id:this.name?"."+a:"")),p=0,d=n.length;d>p;p++)e=n[p],h=e.property,r instanceof l&&r.register(h,s.callback),s.callbackbindings.push(h,r);else X(["Could not bind to "+t+" of constraint "+o+" for "+this.$tagname+(this.id?"#"+this.id:this.name?"."+a:"")]);this.setAttribute(a,u(),!0)}},e.prototype._bindHandlers=function(t){var e,n,i,r,s,o,u,a,h,p;if(this.handlers){if(R)return void B.push(this);for(p=this.handlers,a=0,h=p.length;h>a;a++)e=p[a],u=e.scope,r=e.name,i=e.ev,n=e.callback,s=e.reference,s?(o=this._valueLookup(s)(),o instanceof l&&(u.listenTo(o,i,n),t&&i in o&&n(o[i]))):(u.register(i,n),t&&i in u&&n(u[i]));this.handlers=[]}},e.prototype._constraintCallback=function(t,e){return function(){this.setAttribute(t,e(),!0)}.bind(this)},e.prototype.set_parent=function(t){return t instanceof e&&(this.name&&(t[this.name]=this),t.subnodes.push(this)),t},e.prototype.set_name=function(t){return this.parent&&t&&(this.parent[t]=this),t},e.prototype.set_id=function(t){return window[t]=this,t},e.prototype.animate=function(t,e){var n,i,r,s,o,u,a;null==e&&(e=600),r={};for(o in t)a=t[o],u={motion:"bret",control:[.01]},u[0]=this[o]||0,u[e]=a,n=Animator.createAnimator(),n.playStateless(u),r[o]=n;return s=void 0,i=function(t){return function(e){var u,a,l;if(!t.destroyed){null==s&&(s=e),a=e-s,u=!1;for(o in r)n=r[o],l=n.timestep(a),t.setAttribute(o,l),n.ended&&(u=!0);return u?void 0:dr.idle.callOnIdle(i)}}}(this),dr.idle.callOnIdle(i),this},e.prototype._removeFromParent=function(t){var e,n,i;this.parent&&(e=this.parent[t],n=e.indexOf(this),-1!==n&&(i=e[n],e.splice(n,1),this.parent.sendEvent(t,i),"subnodes"===t&&this.parent.doSubnodeRemoved(i)))},e.prototype._findParents=function(t,e){var n,i;for(n=[],i=this;i;)t in i&&i[t]===e&&n.push(i),i=i.parent;return n},e.prototype._findInParents=function(t){var e;for(e=this.parent;e;){if(t in e)return e[t];e=e.parent}},e.prototype.doSubnodeAdded=function(){},e.prototype.doSubnodeRemoved=function(){},e.prototype.destroy=function(t){var e,n,i,r,s,o;if(this.destroyed=!0,this.sendEvent("destroy",this),this.constraints)for(e in this.constraints)this._unbindConstraint(e);for(this.listeningTo&&this.stopListening(),this.unregister(),(null!=(s=this.parent)?s[this.name]:void 0)===this&&delete this.parent[this.name],o=this.subnodes,i=0,r=o.length;r>i;i++)n=o[i],null!=n&&n.destroy(!0);return t?void 0:this._removeFromParent("subnodes")},e}(l)}.call(this),b=function(){var t,n,i,r,s,o,u=function(t,e){return function(){return t.apply(e,arguments)}},a=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};return t=function(){function t(t,e,n){this._handleScroll=u(this._handleScroll,this);var i;i=n.$tagname||"div",null==e?(this.el=document.createElement(i),this.el.$init=!0):e instanceof HTMLElement&&(this.el=e),this.el.$view=t,null==this.css_baseclass&&(this.css_baseclass="sprite"),this._updateClass()}return t.prototype.setAttribute=function(t,e){var n;switch(t){case"width":case"height":case"z":case"opacity":case"bgcolor":case"color":case"whitespace":case"fontsize":case"fontfamily":case"fontweight":case"text-transform":case"boxshadow":case"leftpadding":case"rightpadding":case"toppadding":case"bottompadding":case"leftborder":case"rightborder":case"topborder":case"bottomborder":case"bordercolor":case"borderstyle":return this.setStyle(t,e);case"bold":return this.setStyle(t,e?"bold":"normal");case"italic":return this.setStyle(t,e?"italic":"normal");case"smallcaps":return this.setStyle(t,e?"small-caps":"normal");case"ellipsis":return this.__ellipsis=e,this.setStyle(t,e?"ellipsis":"clip"),this.__updateOverflow();case"perspective":case"transform-style":case"transform-origin":case"transform":return this.setStyle(T.prefix.css+t,e);default:if(n=this.el.$view._declaredTypes,null==n[t])return this.setStyle(t,e)}},t.prototype.setStyle=function(t){return t?function(t,n,i,r){var s,o;return null==r&&(r=this.el),null==n&&(n=""),t in e&&(t=e[t]),r.style[t]=n,"borderTopWidth"===t||"paddingTop"===t?(s=(this.__BP_TOGGLE=!this.__BP_TOGGLE)?-.001:.001,o=r.style.paddingLeft,r.style.paddingLeft=Number(o.substring(0,o.length-2))+s+"px"):void 0}:function(t,n,i,r){return null==r&&(r=this.el),null==n&&(n=""),t in e&&(t=e[t]),r.style[t]=n}}("WebKit"===T.prefix.dom),t.prototype.set_parent=function(e){return e instanceof t&&(e=e.el),this.el.parentNode!==e?e.appendChild(this.el):void 0},t.prototype.set_id=function(t){return this.el.setAttribute("id",t)},t.prototype._cursorVal=function(){return this.__clickable?this.__cursor||"pointer":""},t.prototype.set_scrollx=function(t){return this.el.scrollLeft!==t?this.el.scrollLeft=t:void 0},t.prototype.set_scrolly=function(t){return this.el.scrollTop!==t?this.el.scrollTop=t:void 0},t.prototype.set_cursor=function(t){return this.__cursor=t,this.setStyle("cursor",this._cursorVal(),!0)},t.prototype.set_visible=function(t){var e,n,i,r;return t?(e=null,n=this.el.$view,i=n.x,r=n.y):(e="hidden",i=r=-1e5),this.setStyle("visibility",e,!0),this.setStyle("marginLeft",i,!0),this.setStyle("marginTop",r,!0)},t.prototype.set_x=function(t){return this.el.$view.visible?this.setStyle("marginLeft",t,!0):void 0},t.prototype.set_y=function(t){return this.el.$view.visible?this.setStyle("marginTop",t,!0):void 0},t.prototype.set_clickable=function(t){return this.__clickable=t,this.__updatePointerEvents(),this.setStyle("cursor",this._cursorVal(),!0)},t.prototype.set_clip=function(t){return this.__clip=t,this.__updateOverflow()},t.prototype.set_scrollable=function(t){return this.__scrollable=t,this.__updateOverflow(),this.__updatePointerEvents(),t?$(this.el).on("scroll",this._handleScroll):$(this.el).off("scroll",this._handleScroll)},t.prototype.set_scrollbars=function(t){return this.__scrollbars=t,this._updateClass()},t.prototype._handleScroll=function(t){var e,n,i,r,s,o;return e=t.target,r=e.$view,r&&(s=e.scrollLeft,o=e.scrollTop,r.scrollx!==s&&r.setAttribute("scrollx",s),r.scrolly!==o&&r.setAttribute("scrolly",o),i=this._lastScrollEvent,n={scrollx:s,scrolly:o,scrollwidth:e.scrollWidth,scrollheight:e.scrollHeight},!i||i.scrollx!==n.scrollx||i.scrolly!==n.scrolly||i.scrollwidth!==n.scrollwidth||i.scrollheight!==n.scrollheight)?(r.sendEvent("scroll",n),this._lastScrollEvent=n):void 0},t.prototype.__updateOverflow=function(){return this.setStyle("overflow",this.__scrollable?"auto":this.__clip||this.__ellipsis?"hidden":"",!0)},t.prototype.__updatePointerEvents=function(){return this.setStyle("pointer-events",this.__clickable||this.__scrollable?"auto":"",!0)},t.prototype.destroy=function(){return this.el.parentNode.removeChild(this.el),this.el=this.jqel=this.el.$view=null},t.prototype.setInnerHTML=function(t){return this.el.innerHTML=t},t.prototype.getInnerHTML=function(){return this.el.innerHTML},t.prototype.getBounds=function(){return this.el.getBoundingClientRect()},t.prototype.getAbsolute=function(){var t;return t=this.getBounds(),{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}},t.prototype.getScrollWidth=function(){return this.el.scrollWidth},t.prototype.getScrollHeight=function(){return this.el.scrollHeight},t.prototype.set_class=function(t){return null==t&&(t=""),this.__classname=t,this._updateClass()},t.prototype._updateClass=function(){var t;return t=this.css_baseclass,this.__classname&&(t+=" "+this.__classname),this.__scrollbars||(t+=" noscrollbar"),this.el.setAttribute("class",t)},t}(),T.camelcss&&(s=t.prototype.setStyle,n=function(t,e){return e.toUpperCase()},r=/-([\da-z])/gi,t.prototype.setStyle=function(t,e,i,o){return null==o&&(o=this.el),t.match(r)&&(t=t.replace(r,n)),s(t,e,i,o)}),L&&(i=["width","height","background-color","opacity","padding","transform","transform-style","transform-origin","z-index","perspective","cursor",T.prefix.css+"transform",T.prefix.css+"transform-style",T.prefix.css+"transform-origin"],o=t.prototype.setStyle,t.prototype.setStyle=function(t,n,r,s){return null==s&&(s=this.el),"$instanceattributes"!==t?(r||t in e||a.call(i,t)>=0||console.warn("Setting unknown CSS property "+t+" = "+n+" on ",this.el.$view,e,r),o(t,n,r,s)):void 0}),t}.call(this),x=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(t,n,i){null==this.css_baseclass&&(this.css_baseclass="sprite sprite-text noselect"),e.__super__.constructor.apply(this,arguments),i.text||(i.text=this.getText())}return n(e,t),e.prototype.setText=function(t){var e,n,i,r,s;if(null!=t){for(s=this.el.childNodes,i=0,r=s.length;r>i;i++)e=s[i],e&&3===e.nodeType&&this.el.removeChild(e);return n=document.createTextNode(t),this.el.appendChild(n)}},e.prototype.getText=function(){var t,e;for(t=this.el.firstChild,e=[];t;)3===t.nodeType&&e.push(t.data.trim()),t=t.nextSibling;return e.join("")},e}(b)}.call(this),d=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(t,n,i){var r;null==this.css_baseclass&&(this.css_baseclass="sprite noselect"),e.__super__.constructor.apply(this,arguments),i.text||(i.text=this.getText()),"true"===i.multiline?r=document.createElement("textarea"):(r=document.createElement("input"),r.setAttribute("type","text")),r.$init=!0,r.setAttribute("class","sprite-inputtext"),this.setStyle("color","inherit",!1,r),this.setStyle("background","inherit",!1,r),this.setStyle("font-variant","inherit",!1,r),this.setStyle("font-style","inherit",!1,r),this.setStyle("font-weight","inherit",!1,r),this.setStyle("font-size","inherit",!1,r),this.setStyle("font-family","inherit",!1,r),this.el.appendChild(r),r.$view=t,$(r).on("focus blur",this.handle),this.input=r}return n(e,t),e.prototype.handle=function(t){var e;return(e=t.target.$view)?e.sendEvent(t.type,e):void 0},e.prototype.destroy=function(){return e.__super__.destroy.apply(this,arguments),this.input?this.input=this.input.$view=null:void 0},e.prototype.value=function(t){return null!=t?this.input.value=t:this.input.value},e}(x)}.call(this),t=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.clearInline=function(){var t,e,n,i,r;for(i=this.el.childNodes,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t&&3===t.nodeType?this.el.removeChild(t):void 0);return r},e}(b)}.call(this),o=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.el.style.backgroundSize="cover"}return n(e,t),e.prototype.destroy=function(){return e.__super__.destroy.apply(this,arguments),this._img?(this._img.$view=null,this._img=null):void 0},e.prototype.setSrc=function(t){var e,n,i,r,s;return e=this.el,s=e.$view,r=e.style,t?(r.backgroundImage='url("'+t+'")',r.backgroundRepeat="no-repeat",n=this._img,n||(n=this._img=new Image,n.$view=s),n.src=t,i=this,n.onload=function(){return s=this.$view,s?(i.naturalWidth=n.width,i.naturalHeight=n.height,i.naturalSize&&(s.setAttribute("width",n.width),s.setAttribute("height",n.height)),s.sendEvent("load",{width:n.width,height:n.height})):void 0},n.onerror=function(){return s=this.$view,s?(i.naturalWidth=i.naturalHeight=void 0,s.sendEvent("error",n)):void 0}):(r.backgroundImage="",s.inited?s.sendEvent("load",{width:0,height:0}):void 0)},e.prototype.setStretches=function(t){return t="scale"===t?"contain":"true"===t?"100% 100%":"cover",this.el.style.backgroundSize=t},e.prototype.setNaturalSize=function(t){var e,n;return this.naturalSize=t,t&&(e=this._img,e&&null!=this.naturalWidth&&null!=this.naturalHeight)?(n=e.$view,n.setAttribute("width",this.naturalWidth),n.setAttribute("height",this.naturalHeight)):void 0},e}(b)}.call(this),k=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.construct=function(t,n){var i,r,s,o;this.subviews=[],s={border:"positivenumber",borderstyle:"string",bottomborder:"positivenumber",bottompadding:"positivenumber","class":"string",clickable:"boolean",clip:"boolean",cursor:"string",height:"size",ignorelayout:"json",layouthint:"json",leftborder:"positivenumber",leftpadding:"positivenumber",opacity:"number",padding:"positivenumber",rightborder:"positivenumber",rightpadding:"positivenumber",rotation:"number",scrollable:"boolean",scrollbars:"boolean",scrollx:"number",scrolly:"number",skin:"string",topborder:"positivenumber",toppadding:"positivenumber",visible:"boolean",width:"size",x:"x",xanchor:"string",xscale:"number",y:"y",yanchor:"string",yscale:"number",z:"number",zanchor:"number",$tagname:"string",$textcontent:"string"},o=n.$types;for(i in o)r=o[i],s[i]=r;return this._declaredTypes=n.$types=s,this.__fullBorderPaddingWidth=this.__fullBorderPaddingHeight=0,this.xanchor=this.yanchor="center",this.cursor="pointer",this.bgcolor=this.bordercolor="transparent",this.borderstyle="solid",this.skin="",this.leftborder=this.rightborder=this.topborder=this.bottomborder=this.border=this.leftpadding=this.rightpadding=this.toppadding=this.bottompadding=this.padding=this.x=this.y=this.width=this.height=this.innerwidth=this.innerheight=this.boundsxdiff=this.boundsydiff=this.boundsx=this.boundsy=this.boundswidth=this.boundsheight=this.zanchor=this.scrollx=this.scrolly=0,this.opacity=1,this.clip=this.scrollable=this.clickable=this.isaligned=this.isvaligned=this.ignorelayout=this.scrollbars=!1,this.visible=!0,this.createSprite(b,t,n),e.__super__.construct.apply(this,arguments)},e.prototype.initialize=function(){return this.__autoLayoutwidth&&this.__autoLayoutwidth.setAttribute("locked",!1),this.__autoLayoutheight&&this.__autoLayoutheight.setAttribute("locked",!1),this.__updateBounds(),e.__super__.initialize.apply(this,arguments)},e.prototype.createSprite=function(t,e,n){return null==t&&(t=b),this.sprite=new t(this,e,n)},e.prototype.destroy=function(t){return e.__super__.destroy.apply(this,arguments),t||this._removeFromParent("subviews"),this.sprite.destroy(),this.sprite=null},e.prototype.defaultSetAttributeBehavior=function(t,n){var i;return i=this[t],e.__super__.defaultSetAttributeBehavior.apply(this,arguments),n=this[t],i!==n?this.sprite.setAttribute(t,n):void 0},e.prototype.getBoundsRelativeToParent=function(){var t,e,n,i,r,s,o,u;return r=this.xanchor,u=this.yanchor,e=this.width,t=this.height,r="left"===r?0:"center"===r?e/2:"right"===r?e:Number(r),u="top"===u?0:"center"===u?t/2:"bottom"===u?t:Number(u),n=this.x,i=n+e,s=this.y,o=s+t,new y([n,s,i,s,i,o,n,o]).transformAroundOrigin(this.xscale,this.yscale,this.rotation,r+n,u+s).getBoundingBox()},e.prototype.__updateBounds=function(){var t,e,n,i,r,s,o;return this.__boundsAreDifferent?(t=this.getBoundsRelativeToParent(),n=t.width,e=t.height,i=t.x,s=t.y,r=this.x-i,o=this.y-s):(i=this.x,s=this.y,r=o=0,n=this.width,e=this.height),F(this.boundsx,i)||this.setAndFire("boundsx",i),F(this.boundsy,s)||this.setAndFire("boundsy",s),F(this.boundswidth,n)||this.setAndFire("boundswidth",n),F(this.boundsheight,e)||this.setAndFire("boundsheight",e),F(this.boundsxdiff,r)||this.setAndFire("boundsxdiff",r),F(this.boundsydiff,o)?void 0:this.setAndFire("boundsydiff",o)},e.prototype.__setupAlignConstraint=function(t,e){var n,i,r,s,o,u,a,l,h,p,d;if(u="__alignFunc"+t,("string"==typeof e||this[u])&&(p=this.parent,p instanceof _&&("x"===t?(a=!0,i="innerwidth",r="boundsxdiff",s="boundswidth",n="isaligned"):(a=!1,i="innerheight",r="boundsydiff",s="boundsheight",n="isvaligned"),h=this[u],h&&(this.stopListening(p,i,h),this.stopListening(this,r,h),this.stopListening(this,s,h),delete this[u],this[n]&&this.setAndFire(n,!1)),"string"==typeof e))){if(l=e.toLowerCase(),d=this,"begin"===l||a&&"left"===l||!a&&"top"===l)o=this[u]=function(){var e;return e=d[r],d[t]!==e?(d.__noSpecialValueHandling=!0,d.setAttribute(t,e)):void 0},o.autoOk=!0;else if("middle"===l||"center"===l)o=this[u]=function(){return d.__noSpecialValueHandling=!0,d.setAttribute(t,(p[i]-d[s])/2+d[r])},this.listenTo(p,i,o),this.listenTo(this,s,o);else if("end"===l||a&&"right"===l||!a&&"bottom"===l)o=this[u]=function(){return d.__noSpecialValueHandling=!0,d.setAttribute(t,p[i]-d[s]+d[r])},this.listenTo(p,i,o),this.listenTo(this,s,o);else if("none"===l)return!0;return o?(this.listenTo(this,r,o),o.call(),this[n]||this.setAndFire(n,!0),
!0):void 0}},e.prototype.__setupAutoConstraint=function(t,e,n){var r,s;return r="__autoLayout"+t,"auto"===e||this[r]?(s=this[r],s&&(s.destroy(),delete this[r]),"auto"===e?(this[r]=new i(null,{parent:this,axis:n,locked:this.inited?"false":"true"}),this.inited||(this.__noSpecialValueHandling=!0,this.setAttribute(t,0)),!0):void 0):void 0},e.prototype.__setupPercentConstraint=function(t,e,n){var i,r,s,o,u,a;return r="__percentFunc"+t,"string"==typeof e||this[r]?(s=this[r],o=this.parent,o instanceof _||(o=dr.window,n=n.substring(5)),s&&(this.stopListening(o,n,s),delete this[r]),j.test(e)?(a=this,u=parseInt(e)/100,i=this[r]=function(){return a.__noSpecialValueHandling=!0,a.setAttribute(t,o[n]*u)},this.listenTo(o,n,i),i.call(),!0):void 0):void 0},e.prototype.set_parent=function(t){var n;return n=e.__super__.set_parent.apply(this,arguments),t instanceof e&&(t.subviews.push(this),t.sendEvent("subviews",this),t=t.sprite),this.sprite.set_parent(t),n},e.prototype.set_id=function(t){var n;return n=e.__super__.set_id.apply(this,arguments),this.sprite.set_id(t),n},e.prototype.set_class=function(t){return this["class"]!==t&&(this.sprite.set_class(t),this.setAndFire("class",t)),V},e.prototype.set_clip=function(t){return this.clip!==t&&(this.sprite.set_clip(t),this.setAndFire("clip",t)),V},e.prototype.set_scrollable=function(t){return this.scrollable!==t&&(this.sprite.set_scrollable(t),this.setAndFire("scrollable",t)),V},e.prototype.set_scrollbars=function(t){return this.scrollbars!==t&&(this.sprite.set_scrollbars(t),this.setAndFire("scrollbars",t)),V},e.prototype.set_scrollx=function(t){return t=isNaN(t)?0:Math.max(0,Math.min(this.sprite.getScrollWidth()-this.width+this.leftborder+this.rightborder,t)),this.scrollx!==t&&(this.sprite.set_scrollx(t),this.setAndFire("scrollx",t)),V},e.prototype.set_scrolly=function(t){return t=isNaN(t)?0:Math.max(0,Math.min(this.sprite.getScrollHeight()-this.height+this.topborder+this.bottomborder,t)),this.scrolly!==t&&(this.sprite.set_scrolly(t),this.setAndFire("scrolly",t)),V},e.prototype.set_visible=function(t){return this.visible!==t&&(this.sprite.set_visible(t),this.setAndFire("visible",t)),V},e.prototype.set_bgcolor=function(t){return this.bgcolor!==t&&(this.sprite.setAttribute("bgcolor",t),this.setAndFire("bgcolor",t)),V},e.prototype.set_x=function(t){if(this.__noSpecialValueHandling)this.__noSpecialValueHandling=!1;else{if(this.__setupPercentConstraint("x",t,"innerwidth"))return V;if(this.__setupAlignConstraint("x",t))return V}return this.x!==t&&(this.sprite.set_x(t),this.__boundsAreDifferent&&t-this.boundsxdiff!==this.boundsx&&this.sendEvent("boundsx",this.boundsx=t-this.boundsxdiff),this.setAndFire("x",t),this.inited&&this.__updateBounds()),V},e.prototype.set_y=function(t){if(this.__noSpecialValueHandling)this.__noSpecialValueHandling=!1;else{if(this.__setupPercentConstraint("y",t,"innerheight"))return V;if(this.__setupAlignConstraint("y",t))return V}return this.y!==t&&(this.sprite.set_y(t),this.__boundsAreDifferent&&t-this.boundsydiff!==this.boundsy&&this.sendEvent("boundsy",this.boundsy=t-this.boundsydiff),this.setAndFire("y",t),this.inited&&this.__updateBounds()),V},e.prototype.set_width=function(t,e){if(this.__noSpecialValueHandling)this.__noSpecialValueHandling=!1;else{if(this.__setupPercentConstraint("width",t,"innerwidth"))return V;if(this.__setupAutoConstraint("width",t,"x"))return V}return t=Math.max(t,this.__fullBorderPaddingWidth),this.width!==t&&(e||this.sprite.setAttribute("width",t),this.setAndFire("innerwidth",t-this.__fullBorderPaddingWidth),this.setAndFire("width",t),this.inited&&this.__updateBounds()),V},e.prototype.set_height=function(t,e){if(this.__noSpecialValueHandling)this.__noSpecialValueHandling=!1;else{if(this.__setupPercentConstraint("height",t,"innerheight"))return V;if(this.__setupAutoConstraint("height",t,"y"))return V}return t=Math.max(t,this.__fullBorderPaddingHeight),this.height!==t&&(e||this.sprite.setAttribute("height",t),this.setAndFire("innerheight",t-this.__fullBorderPaddingHeight),this.setAndFire("height",t),this.inited&&this.__updateBounds()),V},e.prototype.set_border=function(t){return this.__lockBPRecalc=!0,this.setAttribute("topborder",t),this.setAttribute("bottomborder",t),this.setAttribute("leftborder",t),this.setAttribute("rightborder",t),this.__lockBPRecalc=!1,this.setAndFire("border",t),this.__updateInnerWidth(),this.__updateInnerHeight(),V},e.prototype.set_topborder=function(t){return this.sprite.setAttribute("topborder",t),this.setAndFire("topborder",t),this.__lockBPRecalc||(this.__updateBorder(),this.__updateInnerHeight()),V},e.prototype.set_bottomborder=function(t){return this.sprite.setAttribute("bottomborder",t),this.setAndFire("bottomborder",t),this.__lockBPRecalc||(this.__updateBorder(),this.__updateInnerHeight()),V},e.prototype.set_leftborder=function(t){return this.sprite.setAttribute("leftborder",t),this.setAndFire("leftborder",t),this.__lockBPRecalc||(this.__updateBorder(),this.__updateInnerWidth()),V},e.prototype.set_rightborder=function(t){return this.sprite.setAttribute("rightborder",t),this.setAndFire("rightborder",t),this.__lockBPRecalc||(this.__updateBorder(),this.__updateInnerWidth()),V},e.prototype.__updateBorder=function(){var t;return t=this.topborder,this.bottomborder===t&&this.leftborder===t&&this.rightborder===t?this.setAndFire("border",t):null!=this.border?this.setAndFire("border",void 0):void 0},e.prototype.set_padding=function(t){return this.__lockBPRecalc=!0,this.setAttribute("toppadding",t),this.setAttribute("bottompadding",t),this.setAttribute("leftpadding",t),this.setAttribute("rightpadding",t),this.__lockBPRecalc=!1,this.setAndFire("padding",t),this.__updateInnerWidth(),this.__updateInnerHeight(),V},e.prototype.set_toppadding=function(t){return this.sprite.setAttribute("toppadding",t),this.setAndFire("toppadding",t),this.__lockBPRecalc||(this.__updatePadding(),this.__updateInnerHeight()),V},e.prototype.set_bottompadding=function(t){return this.sprite.setAttribute("bottompadding",t),this.setAndFire("bottompadding",t),this.__lockBPRecalc||(this.__updatePadding(),this.__updateInnerHeight()),V},e.prototype.set_leftpadding=function(t){return this.sprite.setAttribute("leftpadding",t),this.setAndFire("leftpadding",t),this.__lockBPRecalc||(this.__updatePadding(),this.__updateInnerWidth()),V},e.prototype.set_rightpadding=function(t){return this.sprite.setAttribute("rightpadding",t),this.setAndFire("rightpadding",t),this.__lockBPRecalc||(this.__updatePadding(),this.__updateInnerWidth()),V},e.prototype.__updatePadding=function(){var t;return t=this.toppadding,this.bottompadding===t&&this.leftpadding===t&&this.rightpadding===t?this.setAndFire("padding",t):null!=this.padding?this.setAndFire("padding",void 0):void 0},e.prototype.__updateInnerWidth=function(){var t;return this.__fullBorderPaddingWidth=t=this.leftborder+this.rightborder+this.leftpadding+this.rightpadding,t>this.width&&(this.__noSpecialValueHandling=!0,this.setAttribute("width",t,!0)),this.setAndFire("innerwidth",this.width-t)},e.prototype.__updateInnerHeight=function(){var t;return this.__fullBorderPaddingHeight=t=this.topborder+this.bottomborder+this.toppadding+this.bottompadding,t>this.height&&(this.__noSpecialValueHandling=!0,this.setAttribute("height",t,!0)),this.setAndFire("innerheight",this.height-t)},e.prototype.set_clickable=function(t){return this.clickable!==t&&(this.sprite.set_clickable(t),this.setAndFire("clickable",t)),V},e.prototype.set_cursor=function(t){return this.cursor!==t&&(this.sprite.set_cursor(t),this.setAndFire("cursor",t)),V},e.prototype.__updateTransform=function(){var t,e,n,i,r;return t="",n=this.xscale,null==this.xscale&&(n=this.xscale=1),r=this.yscale,null==this.yscale&&(r=this.yscale=1),(1!==n||1!==r)&&(t+="scale3d("+n+","+r+",1.0)"),this.rotation||(this.rotation=0),this.rotation%360!==0&&(t+=" rotate3d(0,0,1.0,"+this.rotation+"deg)"),this.__boundsAreDifferent=""!==t,this.z||(this.z=0),0!==this.z&&(t+=" translate3d(0,0,"+this.z+"px)",this.parent.sprite.setAttribute("transform-style","preserve-3d")),""!==t&&(e=this.xanchor,"left"!==e&&"right"!==e&&"center"!==e&&(e+="px"),i=this.yanchor,"top"!==i&&"bottom"!==i&&"center"!==i&&(i+="px"),this.sprite.setAttribute("transform-origin",e+" "+i+" "+this.zanchor+"px")),this.sprite.setAttribute("transform",t)},e.prototype.set_perspective=function(t){return"0"===t?"none":t+"px"},e.prototype.set_xscale=function(t){return t!==this.xscale&&(this.setAndFire("xscale",t),this.__updateTransform(),this.inited&&this.__updateBounds()),V},e.prototype.set_yscale=function(t){return t!==this.yscale&&(this.setAndFire("yscale",t),this.__updateTransform(),this.inited&&this.__updateBounds()),V},e.prototype.set_rotation=function(t){return t!==this.rotation&&(this.setAndFire("rotation",t),this.__updateTransform(),this.inited&&this.__updateBounds()),V},e.prototype.set_z=function(t){return t!==this.z&&(this.sprite.setAttribute("z",t),this.setAndFire("z",t),this.__updateTransform()),V},e.prototype.set_xanchor=function(t){return(null==t||""===t||"undefined"===t)&&(t="center"),t!==this.xanchor&&(this.setAndFire("xanchor",t),this.__updateTransform(),this.inited&&this.__updateBounds()),V},e.prototype.set_yanchor=function(t){return(null==t||""===t||"undefined"===t)&&(t="center"),t!==this.yanchor&&(this.setAndFire("yanchor",t),this.__updateTransform(),this.inited&&this.__updateBounds()),V},e.prototype.set_zanchor=function(t){return(null==t||""===t)&&(t=0),t!==this.zanchor&&(this.setAndFire("zanchor",t),this.__updateTransform()),V},e.prototype.set_skin=function(t){return t!==this.skin&&(this.skin=t,this.reskin(),this.setAndFire("skin",t)),V},e.prototype.attachSkinListener=function(){return this.$skinlistner?void 0:(this.$skinlistner=!0,this.listenTo(this,"subviewAdded",function(t){return t.attachSkinListener(),t.reskin()}))},e.prototype.reskin=function(){var t,e,n,i,r,s;if(this.attachSkinListener(),!window.dr.skins)return void console.log("<skin> hasn't been initialized yet",this);if(this.skin){for(n=this.skin.split(/[^A-Za-z0-9_-]+/),s=[],i=0,r=n.length;r>i;i++)e=n[i],s.push((t=window.dr.skins[e])?t.applyTo(this):console.log("Cannot apply skin:",e));return s}return this.parent&&this.parent.reskin?this.parent.reskin():void 0},e.prototype.moveToFront=function(){var t,e,n,i;for(i=this.parent.subviews,e=0,n=i.length;n>e;e++)t=i[e],t.z||t.setAttribute("z",0),this.z<=t.z&&(this.z=t.z+1);return this.__updateTransform()},e.prototype.moveToBack=function(){var t,e,n,i;for(i=this.parent.subviews,e=0,n=i.length;n>e;e++)t=i[e],t.z||t.setAttribute("z",0),this.z>=t.z&&(this.z=t.z-1);return this.__updateTransform()},e.prototype.moveInFrontOf=function(t){return t?(t.z||t.setAttribute("z",0),this.z=t.z+1,this.__updateTransform()):void 0},e.prototype.moveBehind=function(t){return t?(t.z||t.setAttribute("z",0),this.z=t.z-1,this.__updateTransform()):void 0},e.prototype.doSubnodeAdded=function(t){return t instanceof e?(t.__updateBounds(),this.sendEvent("subviewAdded",t),this.doSubviewAdded(t)):t instanceof f?this.doLayoutAdded(t):void 0},e.prototype.doSubnodeRemoved=function(t){return t instanceof e?(this.sendEvent("subviewRemoved",t),this.doSubviewRemoved(t)):t instanceof f?this.doLayoutRemoved(t):void 0},e.prototype.doSubviewAdded=function(){},e.prototype.doSubviewRemoved=function(){},e.prototype.doLayoutAdded=function(){},e.prototype.doLayoutRemoved=function(){},e.prototype.getLayoutHint=function(t,e){var n,i;if(i=this.layouthint){if(n=i[t+"/"+e],null!=n)return n;if(n=i[e],null!=n)return n;if(n=i["*/"+e],null!=n)return n}},e.prototype.getAbsolute=function(){return this.sprite.getAbsolute()},e}(_)}.call(this),J=[],X=function(t){var e,n;return J=J.concat(t),e=t.join("\n"),n=document.createElement("pre"),n.setAttribute("class","warnings"),n.textContent=e,document.body.insertBefore(n,document.body.firstChild),console.error(e)},Y=["handler","method","attribute","setter","include"],I=/^on(.+)/,U="-",O=function(){var t,e,i,r,o,a,h,p,d,c,g,v,y,b;return o=function(t){var e,n,i,r;for(e={},i=0,r=t.length;r>i;i++)n=t[i],e[n.name]=n.value;return e},y=function(t){var e;return e=document.createEvent("Event"),e.initEvent("dreeminit",!0,!0),window.dispatchEvent(e),$(t).addClass("dreeminited")},c=function(t){return R=!0,t.style.visibility="hidden",r(t,function(){return t.style.visibility=null,d(t),Z(),y(t)})},a=function(t){var e,n,i,r,s;for(r=t.childNodes,s=[],n=0,i=r.length;i>n;n++)e=r[n],1===e.nodeType&&s.push(e);return s},r=function(e,i){var r,o,a,h,p,d,c,g,v,y,b,m,x,A,S,T,E;return y=$(e),g={},S=[],T=!1,o=[],A=function(t,e,n){var i,r;if(!(t in g))return g[t]=!0,o.push(t),T?(S.push(t,n),t):(i=function(t,e,n){var i;return null==n&&(n="failed to load scriptinclude "+t),T=t,i=document.createElement("script"),i.type="text/javascript",$("head").append(i),i.onload=e,i.onerror=function(t){return console.error(n,t),e()},i.src=t},r=function(){return T=!1,0===S.length?e():i(S.shift(),r,S.shift())},i(t,r,n))},v={},p=[],a={},b=function(t,e){var n;if(!(t in a))return a[t]=e,o.push(t),n=$.get(t),n.url=t,n.el=e,p.push(n)},x=function(t,e){var n,i,r,s,o;if(null==e&&(e={}),t.attributes["with"]&&null!=t.attributes["with"].value){for(s=t.attributes["with"].value.split(","),o=[],i=0,r=s.length;r>i;i++)n=s[i],o.push(e[n.trim()]=t);return o}},c=function(e){var n,i,r,o,u,l,h,p;for(null==e&&(e={}),l=y.find("*"),o=0,u=l.length;u>o;o++)n=l[o],i=n.localName,"class"===i?(n.attributes["extends"]&&(e[n.attributes["extends"].value]=n),x(n,e),v[null!=(h=n.attributes.name)?h.value:void 0]=!0):"replicator"===i?(e[i]=n,e[n.attributes.classname.value]=n,x(n,e)):(p=n.parentNode.localName,s.call(Y,p)<0&&(e[i]=n,x(n,e)));r={};for(i in e)n=e[i],i in dr||i in a||s.call(Y,i)>=0||i in v||t[i]||(r[i]=n);return r},d=function(t){var e,n,i,r,s;for(null==t&&(t={}),s=y.find("include"),i=0,r=s.length;r>i;i++)e=s[i],n=e.attributes.href.value,e.parentNode.removeChild(e),t[n]=e;return t},m=function(t){var e,i,r;a.skin||(a.skin=!0,b(DREEM_ROOT+"classes/skin.dre")),r=d();for(i in r)e=r[i],b(i,e);return $.when.apply($,p).done(function(){var r,s,o,h,g,v,x,S,T,E;for(r=1<=arguments.length?n.call(arguments,0):[],1===p.length&&(r=[r]),p=[],h=/<[\/]*library>/gi,x=0,S=r.length;S>x;x++)v=r[x],o=v[0].replace(h,""),y.prepend(o);T=c();for(g in T)e=T[g],a[g]=!0,g&&b(DREEM_ROOT+"classes/"+g.split(U).join("/")+".dre",e);$.when.apply($,p).done(function(){var r,s,o,a,h;for(r=1<=arguments.length?n.call(arguments,0):[],1===p.length&&(r=[r]),p=[],a=0,h=r.length;h>a;a++)v=r[a],y.prepend(v[0]),y.contents().each(function(){return this.nodeType===u?$(this).remove():void 0});return s=c(d()),Object.keys(s).length>0?void m(t):(o=DREEM_ROOT+"lib/one_base.js",$.ajax({dataType:"script",cache:!0,url:o}).done(function(){var n,r,s,o,u;for(ONE.base_.call(l.prototype),l.prototype.enumfalse(l.prototype.keys()),_.prototype.enumfalse(_.prototype.keys()),k.prototype.enumfalse(k.prototype.keys()),f.prototype.enumfalse(f.prototype.keys()),w.prototype.enumfalse(w.prototype.keys()),A(DREEM_ROOT+"lib/animator.js",t,"Missing /lib/animator.js"),o=y.find("[scriptincludes]"),u=[],r=0,s=o.length;s>r;r++)e=o[r],u.push(function(){var r,s,o,u,a;for(o=e.attributes.scriptincludes.value.split(","),a=[],r=0,s=o.length;s>r;r++)i=o[r],n=i.trim(),n.match(/^\w+:\/\//)||n.match(/^\//)||(n=DREEM_ROOT+n),a.push(A(n,t,null!=(u=e.attributes.scriptincludeserror)?u.value.toString():void 0));return a}());return u}).fail(function(){return console.warn("failed to load "+o)}))}).fail(function(){var t,e,i;for(t=1<=arguments.length?n.call(arguments,0):[],1===t.length&&(t=[t]),e=0,i=t.length;i>e;e++)v=t[e],X(["failed to load "+v.url+" for element "+v.el.outerHTML])}),E=[];for(s in a)E.push(a[s]=!0);return E}).fail(function(){var t,e,i,r;for(t=1<=arguments.length?n.call(arguments,0):[],1===t.length&&(t=[t]),i=0,r=t.length;r>i;i++)e=t[i],X(["failed to load "+e.url+" for element "+e.el.outerHTML])})},r=["/primus/primus.io.js"],h=function(){var t;return o.push(window.location.pathname),o.push("/core/layout.coffee"),t=o.filter(function(t){return s.call(r,t)<0?!0:void 0}),$.ajax({url:"/watchfile/",datatype:"text",data:{url:t},success:function(e){return s.call(t,e)>=0?window.location.reload():void 0}}).done(function(){return h()})},E=function(){return $.ajax({url:"/validate/",data:{url:window.location.pathname},success:function(t){return t.length&&X(t),h()},error:function(){return console.warn("Validation requires the Teem server")}}).always(i)},m(G?i:E)},t={a:!0,abbr:!0,address:!0,area:!0,article:!0,aside:!0,audio:!0,b:!0,base:!0,bdi:!0,bdo:!0,blockquote:!0,body:!0,br:!0,button:!0,canvas:!0,caption:!0,cite:!0,code:!0,col:!0,colgroup:!0,command:!0,datalist:!0,dd:!0,del:!0,details:!0,dfn:!0,div:!0,dl:!0,dt:!0,em:!0,embed:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,head:!0,header:!0,hgroup:!0,hr:!0,html:!0,i:!0,iframe:!0,img:!0,image:!0,input:!0,ins:!0,kbd:!0,keygen:!0,label:!0,legend:!0,li:!0,link:!0,map:!0,mark:!0,menu:!0,meta:!0,meter:!0,nav:!0,noscript:!0,object:!0,ol:!0,optgroup:!0,option:!0,output:!0,p:!0,param:!0,pre:!0,progress:!0,q:!0,rp:!0,rt:!0,ruby:!0,s:!0,samp:!0,script:!0,section:!0,select:!0,small:!0,source:!0,span:!0,strong:!0,style:!0,sub:!0,summary:!0,sup:!0,table:!0,tbody:!0,td:!0,textarea:!0,tfoot:!0,th:!0,thead:!0,time:!0,title:!0,tr:!0,track:!0,u:!0,ul:!0,"var":!0,video:!0,wbr:!0},v={"class":{name:1},method:{name:1},setter:{name:1},handler:{event:1},attribute:{name:1,type:1,value:1},dataset:{name:1},replicator:{classname:1}},e=function(t,e,n,i){var r,s;if(t in v)for(r in v[t])r in e||(s=""+t+"."+r+" must be defined on "+n.outerHTML,i&&(s+=" inside "+i.outerHTML),X([s]));return s},d=function(n,i){var r,u,a,l,h,p,c,f,g,v,_,y,b,m,w,x;if(!n.$init){if(n.$init=!0,y=n.localName,!y in dr)return void(t[y]||console.warn("could not find class for tag",y,n));if(t[y])return void("input"!==y&&console.warn("refusing to create a class that would overwrite the builtin tag",y));for(u=o(n.attributes),e(y,u,n),u.$tagname=y,b=0,w=D.length;w>b;b++)p=D[b],c="on"+p,c in u&&(u.clickable!==!1&&(u.clickable=!0),n.removeAttribute(c));for(r in u)I.test(r)&&n.removeAttribute(r);if(null==i&&(i=n.parentNode),null!=i&&(u.parent=i),v=y.lastIndexOf("state"),g=v>-1&&v===y.length-5,f="class"===y,f||g||O.processSpecialTags(n,u,u.type),h=O.getChildElements(n),u.$skiponinit=_=h.length>0,"function"!=typeof dr[y])return void X(["Unrecognized class "+y+" "+n.outerHTML]);if(i=new dr[y](n,u,!0),h.length>0&&!f&&!g){if(!dr[y].skipinitchildren)for(h=function(){var t,e,i,r,o;for(i=O.getChildElements(n),o=[],t=0,e=i.length;e>t;t++)l=i[t],r=l.localName,s.call(Y,r)<0&&o.push(l);return o}(),m=0,x=h.length;x>m;m++)l=h[m],d(l,i);i.inited||(a=function(){i.inited||(i._bindHandlers(!0),i.initialize())},S(a))}}},b=function(){var t,e,n,i,r,s;return r=document.createElement("style"),r.type="text/css",n=["position:absolute","pointer-events:none","padding:0","margin:0","box-sizing:border-box","border-color:transparent","border-style:solid","border-width:0"],i=["white-space:nowrap","padding:0","margin:0","text-decoration:none","font-family:mission-gothic, 'Helvetica Neue', Helvetica, Arial, sans-serif","font-size:20px"],e=["border:none","outline:none","background-color:transparent","resize:none"],t=["-webkit-touch-callout:none","-webkit-user-select:none","-khtml-user-select:none","-moz-user-select:none","-ms-user-select:none","user-select:none"],s=["font-size:14px","background-color:pink","margin:0"],r.innerHTML=".sprite{"+n.join(";")+"}.sprite-text{"+i.join(";")+"}.sprite-inputtext{"+e.join(";")+"}.noselect{"+t.join(";")+"}.warnings{"+s.join(";")+"}.noscrollbar::-webkit-scrollbar{display:none;}.hidden{display:none}method,handler,setter,class,node,dataset{display:none}",document.getElementsByTagName("head")[0].appendChild(r)},p=function(t){var e,n,i;for(null==t&&(t=$("view").not("view view")),n=0,i=t.length;i>n;n++)e=t[n],c(e)},h=function(t){var e,n,i,r,s,o;for(n=document.createElement("div"),n.innerHTML=t,i="",o=n.childNodes,r=0,s=o.length;s>r;r++){if(e=o[r],null==e.nodeValue||3!==e.nodeType&&8!==e.nodeType)return;i+=e.nodeValue}return i},g=function(t,n,i){var r,u,a,l,p,d,c,f,g,v,_,y,b,m;for(null==n.$types&&(n.$types={}),null==n.$methods&&(n.$methods={}),null==n.$handlers&&(n.$handlers=[]),l=function(){var e,n,i,r,o;for(i=O.getChildElements(t),o=[],e=0,n=i.length;n>e;e++)a=i[e],r=a.localName,s.call(Y,r)>=0&&o.push(a);return o}(),_=0,y=l.length;y>_;_++)switch(a=l[_],u=o(a.attributes),f=a.localName,r=(null!=(b=u.args)?b:"").split(),c=h(a.innerHTML),null==c&&console.warn("Invalid tag",d,a),g=null!=(m=u.type)?m:i,d=u.name,e(f,u,a,t),f){case"handler":p={name:d,ev:u.event,script:H.transform(c,g),args:r,reference:u.reference,method:u.method},n.$handlers.push(p);break;case"method":case"setter":"setter"===f&&(d="set_"+d.toLowerCase()),null==(v=n.$methods)[d]&&(v[d]=[]),n.$methods[d].push({method:H.transform(c,g),args:r,allocation:u.allocation});break;case"attribute":d=d.toLowerCase(),n[d]=u.value,n.$types[d]=u.type}return l},i={initAllElements:p,initElement:d,processSpecialTags:g,writeCSS:b,getChildElements:a}}(),w=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};return t=function(t){function e(t,e){var n,r,s,o,u,a,l,h,p,d,c,f,g,v,_,y;for(null==e&&(e={}),this.skipattributes=["parent","types","applyattributes","applied","skipattributes","stateattributes","subnodes"],this.subnodes=[],this.stateattributes=e,this.applyattributes={},this.applied=!1,r=e.type,l=O.processSpecialTags(t,e,r),a=t.innerHTML.trim(),c=0,g=l.length;g>c;c++)n=l[c],n.parentNode.removeChild(n);this.instancebody=t.innerHTML.trim(),a&&(t.innerHTML=a),this.types=null!=(_=e.$types)?_:{},this.setAttribute("parent",e.parent),null==(p=this.parent).states&&(p.states=[]),null==(d=this.parent.states).origmethods&&(d.origmethods={}),this.parent.states.push(this),this.parent.sendEvent("states",this.parent.states),this.statemethods=e.$methods;for(u in e)h=e[u],i.call(this.skipattributes,u)>=0||"$"===u.charAt(0)||("name"!==u&&(this.applyattributes[u]=h),this.setAttribute(u,h));for(e.applied&&this.bindAttribute("applied",e.applied,"state"),y=e.$handlers,f=0,v=y.length;v>f;f++)o=y[f],"onapplied"===o.ev&&(this.installHandlers([o],"state",this),this._bindHandlers());s=function(t){return function(){return t.constraints&&t._bindConstraints(),t.events&&t.skipattributes.push("events"),t.enumfalse(t.skipattributes)}}(this),S(s),t&&(t.$view=this),this.children=[],this.initialize(!0)}return n(e,t),e.prototype.set_applied=function(t){var e,n,i;if(this.parent&&this.applied!==t){n=this.parent.states.origmethods;for(e in n)this.parent[e]=n[e];t?this._apply():this._remove();for(e in this.applyattributes)i=this.parent[e],delete this.parent[e],this.parent.setAttribute(e,i,!0)}return t},e.prototype._apply=function(){var t,e,n,r,s,o,u,a,l,h,p,d,c,f,g,v;if(!this.applied){this.parent.learn(this),o=this.parent.states.origmethods;for(s in this.statemethods)s in this.parent&&i.call(o,s)<0&&(o[s]=this.parent[s]);for(v=this.parent.states,h=0,c=v.length;c>h;h++)a=v[h],(a.applied||a===this)&&this.parent.installMethods(a.statemethods,this.parent.$tagname,this.parent,this.parent);if(this.instancebody){for(u=this.parent.sprite.el,e=O.getChildElements(u),p=0,f=e.length;f>p;p++)n=e[p],n.$view&&(n.$view=null);for(u.innerHTML+=this.instancebody,t=O.getChildElements(u),r=d=0,g=t.length;g>d;r=++d)n=t[r],r<e.length?(l=this.parent.subnodes[r],(null!=l?l.sprite:void 0)&&(l.sprite.el=n),n.$view=l):(O.initElement(n,this.parent),this.children.push(n.$view))}return this.stateattributes.$handlers?(this.parent.installHandlers(this.stateattributes.$handlers,this.parent.$tagname,this.parent),this.parent._bindHandlers()):void 0}},e.prototype._remove=function(){var t,e,n,i,r;if(this.applied){for(this.parent.forget(this);t=this.children.pop();)t.destroy();for(r=this.parent.states,n=0,i=r.length;i>n;n++)e=r[n],e.applied&&e!==this&&this.parent.installMethods(e.statemethods,this.parent.$tagname,this.parent,this.parent);return this.stateattributes.$handlers?this.parent.removeHandlers(this.stateattributes.$handlers,this.parent.$tagname,this.parent):void 0}},e}(_)}.call(this),a=function(){var t,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};return t=function(){function t(t,n){var i,r,s,o,a,l,h,p,d,c,f,g,v,_,y,b,m,w,x,k,A,T,$,F;null==n&&(n={}),f=n.name?n.name.toLowerCase():n.name,o=null!=n["extends"]?n["extends"]:n["extends"]="view",r=n.type,m="false"===n.initchildren,delete n.initchildren;for(h in N)delete n[h];for(F=t.childNodes,w=0,A=F.length;A>w;w++)i=F[w],null!=i&&i.nodeType===u&&i.parentNode.removeChild(i);for(b=O.processSpecialTags(t,n,r),v=t.innerHTML.trim(),x=0,T=b.length;T>x;x++)i=b[x],i.parentNode.removeChild(i);if(a=O.getChildElements(t).length>0,p=t.innerHTML.trim(),v&&(t.innerHTML=v),f in dr&&console.warn("overwriting class",f),dr[f]=d=function(t,r,s,u){var l,h,d,c,g,v,_,y,b;if(l=E(n),Q(r,l),null==l.$instanceattributes&&(l.$instanceattributes=r),!(o in dr))return void console.warn("could not find class for tag",o);if("class"!==l.$tagname&&l.$tagname||(l.$tagname=f),l.$skiponinit=!0,l.$deferbindings=a,d=new dr[o](t,l,!0,!0),g=null!=(b=d.sprite)?b.el:void 0,t&&(g||t.setAttribute("class","hidden")),g&&(p&&(v=g.innerHTML.trim(),g.innerHTML=v?p+v:p),!u&&(h=function(){var t,n,r,s,o;for(r=O.getChildElements(g),o=[],t=0,n=r.length;n>t;t++)i=r[t],s=i.localName,e.call(Y,s)<0&&o.push(i);return o}(),!m)))for(_=0,y=h.length;y>_;_++)i=h[_],O.initElement(i,d);return u||(c=function(){return d.inited?void 0:(d._bindHandlers(!0),d.initialize())},s?S(c):c()),d},f&&(y=f.split(U),c=y.length,c>1))for(s=dr,l=k=0,$=y.length;$>k;l=++k)_=y[l],l===c-1?s[_]=d:(g=s[_],g||(s[_]=g={}),s=g);d.skipinitchildren=m,d.classattributes=n}return t}()}.call(this),f=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.construct=function(t,n){var i,r,s,o,u,a;if(null==n.$types&&(n.$types={}),n.$types.locked="boolean",null!=n.locked&&(i="true"===n.locked?!0:!1),this.locked=!0,this.subviews=[],e.__super__.construct.apply(this,arguments),this.listenTo(this.parent,"subviewAdded",this.addSubview.bind(this)),this.listenTo(this.parent,"subviewRemoved",this.removeSubview.bind(this)),this.listenTo(this.parent,"init",this.update.bind(this)),null==(o=this.parent).layouts&&(o.layouts=[]),this.parent.layouts.push(this),this.parent.sendEvent("layouts",this.parent.layouts),s=this.parent.subviews,s&&this.parent.inited)for(u=0,a=s.length;a>u;u++)r=s[u],this.addSubview(r);return this.locked=null!=i?i:!1,this.update()},e.prototype.destroy=function(t){return this.locked=!0,e.__super__.destroy.apply(this,arguments),t?void 0:this._removeFromParent("layouts")},e.prototype.addSubview=function(t){var e,n;return n=this,e=this.__ignoreFunc=function(){return-1===n.__removeSubview(this)?n.__addSubview(this):void 0},this.startMonitoringSubviewForIgnore(t,e),this.__addSubview(t)},e.prototype.__addSubview=function(t){return this.ignore(t)?void 0:(this.subviews.push(t),this.startMonitoringSubview(t),this.locked?void 0:this.update())},e.prototype.removeSubview=function(t){return this.stopMonitoringSubviewForIgnore(t,this.__ignoreFunc),this.ignore(t)?-1:this.__removeSubview(t)},e.prototype.__removeSubview=function(t){var e;return e=this.subviews.indexOf(t),-1!==e&&(this.stopMonitoringSubview(t),this.subviews.splice(e,1),this.locked||this.update()),e},e.prototype.startMonitoringSubviewForIgnore=function(t,e){return this.listenTo(t,"ignorelayout",e)},e.prototype.stopMonitoringSubviewForIgnore=function(t,e){return this.stopListening(t,"ignorelayout",e)},e.prototype.ignore=function(t){var e,n,i;return e=t.ignorelayout,"object"==typeof e?(n=this.name,n?(i=e[n],null!=i?i:e["*"]):e["*"]):e},e.prototype.startMonitoringSubview=function(){},e.prototype.startMonitoringAllSubviews=function(){var t,e,n;for(e=this.subviews,t=e.length,n=[];t;)n.push(this.startMonitoringSubview(e[--t]));return n},e.prototype.stopMonitoringSubview=function(){},e.prototype.stopMonitoringAllSubviews=function(){var t,e,n;for(e=this.subviews,t=e.length,n=[];t;)n.push(this.stopMonitoringSubview(e[--t]));return n},e.prototype.canUpdate=function(){return!this.locked&&this.parent.inited},e.prototype.update=function(){},e.prototype.set_locked=function(t){return this.locked!==t&&t===!1&&(this.locked=!1,this.update()),t},e}(_)}.call(this),i=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.startMonitoringSubview=function(t){var e;return e=this.update.bind(this),"x"===this.axis?(this.listenTo(t,"x",e),this.listenTo(t,"width",e),this.listenTo(t,"boundsx",e),this.listenTo(t,"boundswidth",e)):(this.listenTo(t,"y",e),this.listenTo(t,"height",e),this.listenTo(t,"boundsy",e),this.listenTo(t,"boundsheight",e)),this.listenTo(t,"visible",e)},e.prototype.stopMonitoringSubview=function(t){var e;return e=this.update.bind(this),"x"===this.axis?(this.stopListening(t,"x",e),this.stopListening(t,"width",e),this.stopListening(t,"boundsx",e),this.stopListening(t,"boundswidth",e)):(this.stopListening(t,"y",e),this.stopListening(t,"height",e),this.stopListening(t,"boundsy",e),this.stopListening(t,"boundsheight",e)),this.stopListening(t,"visible",e)},e.prototype.update=function(){var t,e,n,i,r,s,o;if(!this.locked&&this.axis){if(this.locked=!0,s=this.subviews,t=s.length,n=Math.max,i=this.parent,e=0,"x"===this.axis){for(;t;)r=s[--t],this._skipX(r)||(e=n(e,r.boundsx+n(0,r.boundswidth)));o=e+i.__fullBorderPaddingWidth,i.width!==o&&(i.__noSpecialValueHandling=!0,i.setAttribute("width",o))}else{for(;t;)r=s[--t],this._skipY(r)||(e=n(e,r.boundsy+n(0,r.boundsheight)));o=e+i.__fullBorderPaddingHeight,i.height!==o&&(i.__noSpecialValueHandling=!0,i.setAttribute("height",o))}return this.locked=!1}},e.prototype._skipX=function(t){return!t.visible||null!=t.__percentFuncwidth||null!=t.__percentFuncx||null!=t.__alignFuncx&&!t.__alignFuncx.autoOk},e.prototype._skipY=function(t){return!t.visible||null!=t.__percentFuncheight||null!=t.__percentFuncy||null!=t.__alignFuncy&&!t.__alignFuncy.autoOk},e}(f)}.call(this),y=function(){var t;return t=function(){function t(t){null==t&&(t=[]),this._boundingBox=null,this.vectors=t}return t.prototype.degreesToRadians=function(t){return t*Math.PI/180},t.prototype.radiansToDegrees=function(t){return 180*t/Math.PI},t.prototype.translate=function(t,e){var n,i;for(i=this.vectors,n=i.length;n;)i[--n]+=e,i[--n]+=t;return this._boundingBox=null,this},t.prototype.rotate=function(t){var e,n,i,r,s,o,u;for(t=this.degreesToRadians(t),e=Math.cos(t),r=Math.sin(t),s=this.vectors,i=s.length,n=0;i>n;)o=s[n]*e-s[n+1]*r,u=s[n]*r+s[n+1]*e,s[n++]=o,s[n++]=u;return this._boundingBox=null,this},t.prototype.scale=function(t,e){var n,i;for(i=this.vectors,n=i.length;n;)i[--n]*=e,i[--n]*=t;return this._boundingBox=null,this},t.prototype.transformAroundOrigin=function(t,e,n,i,r){return this.translate(-i,-r).rotate(n).scale(t,e).translate(i,r)},t.prototype.getBoundingBox=function(){var t,e,n,i,r,s,o,u;if(this._boundingBox)return this._boundingBox;if(s=this.vectors,t=s.length,t>=2){for(r=n=s[--t],i=e=s[--t];t;)u=s[--t],o=s[--t],r=Math.min(u,r),n=Math.max(u,n),i=Math.min(o,i),e=Math.max(o,e);return this._boundingBox={x:i,y:r,width:e-i,height:n-r}}return this._boundingBox=null},t}()}.call(this),m=function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);

return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};return t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.register=function(){return e.__super__.register.apply(this,arguments),this.startEventTest()?this.startEvent():void 0},e.prototype.unregister=function(){return e.__super__.unregister.apply(this,arguments),this.startEventTest()?void 0:this.stopEvent()},e.prototype.startEvent=function(){return this.eventStarted?void 0:this.eventStarted=!0},e.prototype.stopEvent=function(){return this.eventStarted?this.eventStarted=!1:void 0},e}(l)}.call(this),K=Date.now(),P=function(){var t,e,n,i;return e=T.raf,e||(e=function(){return function(t){var e;return e=function(){return t(Date.now()-K)},window.setTimeout(e,1e3/60)}}()),i=!1,n=[],t=function(t){var e;for(e in n)n[e]&&(n[e](t),n[e]=null);return i=!1},function(r,s){return i||(e(t),i=!0),n[r]=s}}(),S=function(){var t,e;return e=[],t=function(n){var i,r,s,o;for(r=e,e=[],s=0,o=r.length;o>s;s++)(i=r[s])(n);e.length&&setTimeout(function(){return P(2,t)},0)},T.raf?function(n){e.push(n),P(2,t)}:function(t){setTimeout(function(){return t(Date.now()-K)},0)}}(),p=function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};return t=function(t){function n(){return this.sender=e(this.sender,this),this.startEvent=e(this.startEvent,this),n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.startEventTest=function(){var t,e;return t=null!=(e=this.events.idle)?e.length:void 0,t?t:void 0},n.prototype.startEvent=function(){n.__super__.startEvent.apply(this,arguments),P(1,this.sender)},n.prototype.sender=function(t){return this.sendEvent("idle",t),setTimeout(function(t){return function(){return P(1,t.sender)}}(this),0)},n.prototype.callOnIdle=function(t){return S(t)},n}(m)}.call(this),D=["click","mouseover","mouseout","mousedown","mouseup"],v=function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};return t=function(t){function n(){this.sender=e(this.sender,this),this.handle=e(this.handle,this),this.touchHandler=e(this.touchHandler,this),this.x=0,this.y=0,this.docSelector=$(document),this.docSelector.on(D.join(" "),this.handle),this.docSelector.on("mousemove",this.handle).one("mouseout",this.stopEvent),T.touch&&(document.addEventListener("touchstart",this.touchHandler,!0),document.addEventListener("touchmove",this.touchHandler,!0),document.addEventListener("touchend",this.touchHandler,!0),document.addEventListener("touchcancel",this.touchHandler,!0))}var r,s,o;return i(n,t),o=function(t){return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1},n.prototype.startEventTest=function(){var t,e,n;return(null!=(t=this.events.mousemove)?t.length:void 0)||(null!=(e=this.events.x)?e.length:void 0)||(null!=(n=this.events.y)?n.length:void 0)},n.prototype.sendMouseEvent=function(t,e){var n;return n=document.createEvent("MouseEvent"),n.initMouseEvent(t,!0,!0,window,1,e.pageX,e.pageY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n),e.target.$view&&"inputtext"!==e.target.$view.$tagname?o(event):void 0},r=null,s=null,n.prototype.touchHandler=function(t){var e,n,i;switch(i=t.changedTouches,e=i[0],t.type){case"touchstart":return this.sendMouseEvent("mouseover",e),this.sendMouseEvent("mousedown",e),r=e.target;case"touchmove":return n=document.elementFromPoint(e.pageX-window.pageXOffset,e.pageY-window.pageYOffset),n&&n.$view&&(s&&s!==n&&this.handle({target:s,type:"mouseout"}),s=n,this.handle({target:n,type:"mouseover"})),this.sendMouseEvent("mousemove",e);case"touchend":if(this.sendMouseEvent("mouseup",e),r===e.target)return this.sendMouseEvent("click",e),r=null}},n.prototype.handle=function(t){var e,n;return n=t.target.$view,e=t.type,n&&"mousedown"===e&&(this._lastMouseDown=n,"inputtext"!==n.$tagname&&o(t)),"mouseup"===e&&this._lastMouseDown&&this._lastMouseDown!==n?(this.sendEvent("mouseup",this._lastMouseDown),this._lastMouseDown.sendEvent("mouseup",this._lastMouseDown),this.sendEvent("mouseupoutside",this._lastMouseDown),this._lastMouseDown.sendEvent("mouseupoutside",this._lastMouseDown),void(this._lastMouseDown=null)):(n&&n.sendEvent(e,n),this.x=t.pageX,this.y=t.pageY,void(this.eventStarted&&"mousemove"===e?P(0,this.sender):this.sendEvent(e,n)))},n.prototype.sender=function(){return this.sendEvent("mousemove",{x:this.x,y:this.y}),this.sendEvent("x",this.x),this.sendEvent("y",this.y)},n.prototype.handleDocEvent=function(t){return t&&t.target!==document?void 0:this.eventStarted?this.docSelector.on("mousemove",this.handle).one("mouseout",this.stopEvent):this.docSelector.on("mousemove",this.handle).one("mouseout",this.startEvent)},n}(m)}.call(this),A=function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};return t=function(t){function n(){this.handle=e(this.handle,this);var t,n,i;window.addEventListener("resize",this.handle,!1),this.visible=!0,null!=document.hidden?(n="hidden",i="visibilitychange"):null!=document.mozHidden?(n="mozHidden",i="mozvisibilitychange"):null!=document.msHidden?(n="msHidden",i="msvisibilitychange"):null!=document.webkitHidden&&(n="webkitHidden",i="webkitvisibilitychange"),t=function(t){return function(){return t.visible=document[n],t.sendEvent("visible",t.visible)}}(this),document.addEventListener(i,t,!1),this.handle()}return i(n,t),n.prototype.startEventTest=function(){var t,e;return(null!=(t=this.events.width)?t.length:void 0)||(null!=(e=this.events.height)?e.length:void 0)},n.prototype.handle=function(){this.width=window.innerWidth,this.sendEvent("width",this.width),this.height=window.innerHeight,this.sendEvent("height",this.height)},n}(m)}.call(this),c=function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};return t=function(t){function n(){this.handle=e(this.handle,this),this.keys={shiftKey:!1,altKey:!1,ctrlKey:!1,metaKey:!1,keyCode:0},$(document).on("select change keyup keydown",this.handle)}return i(n,t),n.prototype.handle=function(t){var e,n,i;n=t.target.$view,i=t.type;for(e in this.keys)this.keys[e]=t[e];return this.keys.type=i,n&&n.sendEvent(i,this.keys),"select"!==i&&"change"!==i?(this.sendEvent(i,this.keys),this.sendEvent("keys",this.keys)):void 0},n}(l)}.call(this),window.onerror=function(t){return X([""+t.toString()+". Try running in debug mode for more info. "+window.location.href+(q?"&":"?")+"debug"])},z={view:k,"class":a,node:_,mouse:new v,keyboard:new c,window:new A,layout:f,idle:new p,state:w,_noop:V,_sprite:b,_textSprite:x,_inputTextSprite:d,_artSprite:t,_bitmapSprite:o,initElements:O.initAllElements,writeCSS:O.writeCSS,initConstraints:Z}}(),dr.writeCSS(),$(window).on("load",function(){return dr.initElements(),t(!0)})}).call(this);