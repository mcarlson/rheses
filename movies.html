<html>
<head>
  <title>dr33m</title>
  <style type="text/css">
    body {
      font-family: 'Helvetica';
      font-size: 14px;
      background-color: silver;
      padding: 0px;
      margin: 0px;
    }
    input {
      font-family: 'Helvetica';
      font-size: 14px;
      margin: 0px;
      padding: 0px;
      width: 100px;
    }
  </style>
  <script type="text/javascript" src="lib/jquery-1.9.1.js"></script>
  <script type="text/javascript" src="lib/acorn.js"></script>
  <script type="text/javascript" src="lib/coffee-script.js"></script>
  <script type="text/javascript" src="layout.js"></script>
  <script type="text/javascript" src="lib/md5.js"></script>
</head>
<body>
  <view id="container">

    <dataset name="topmovies" url="top_movies.json"></dataset>
    <dataset name="actor"></dataset>

    <class name="castmember" extends="text" font-size="60" font-weight="bold" color="white" text-shadow="0px 0px 5px rgba(173, 173, 173, 1)" z-index="10000">
      <handler name="onmouseover">
        this.setAttribute('color', 'pink')
      </handler>
      <handler name="onmouseout">
        this.setAttribute('color', 'white')
      </handler>
      <handler name="onclick">
        var url = '/api/search/v2.1/amgvideo/search?entitytype=credit&include=filmography&size=1&query=' + this.data;
        //var url = 'actor.json'
        //console.log('click', url, lz.datasets)
        lz.datasets.actor.setAttribute('url', url);
        //console.log('clicked cast member', this.parent, this.replicator)
        this.replicator.clear();
      </handler>
    </class>

    <class name="thumbnail" type="coffee" background-size="cover" transition="all .5s" border-style="solid" border-width="0" border-color="white">
      <handler name="onmouseover">
        this.setAttribute('border-width', 3);
      </handler>
      <handler name="onmouseout">
        this.setAttribute('border-width', 0);
      </handler>
      <handler name="onclick">
        new lz.replicator(null, {datapath: "/cast[0..4]/name", classname: "castmember", parent: this})
      </handler>
      <handler name="ondata" args="data">
        if data.images
          for image in data.images
            continue if image.width > 120 or image.width < 0

          return if image.width > 120 or image.width < 20

          this.setAttribute('width', image.width * 2);
          this.setAttribute('height', image.height * 2);
          this.setAttribute('background-image', "url('" + image.url + "')");

          # console.log('image', image)

        if data.genres
          color = '#' + md5(data.genres[0].id).substring(0,6)
          # this.setAttribute('background-color', color);
          # console.log('genre color', color);
      </handler>

      <simplelayout attribute="y" axis="height" spacing="1"></simplelayout>
      <!-- <replicator datapath="/cast[0..5]/name" classname="castmember"></replicator> -->
    </class>

    <simplelayout></simplelayout>
    <view width="${lz.window.width - this.parent.actors.width - 10}">
      <handler name="onx" reference="lz.mouse" args="x">
        //this.setAttribute('width', lz.mouse.x)
      </handler>

      <wraplayout></wraplayout>
      <replicator datapath="$topmovies/searchResponse/results[*]/movie" classname="thumbnail"></replicator>
    </view>

    <view name="actors" x="${lz.window.width - this.width}" height="${lz.window.height}" bgcolor="white" transition="width .2s" position="fixed">
      <boundslayout ignoreattr="height"></boundslayout>
      <simplelayout attribute="y" axis="height" spacing="1"></simplelayout>
      <replicator datapath="$actor/searchResponse/results[0..10]/name/filmography[*]/title" classname="text"></replicator>
    </view>

    <!-- <dataset name="movies" url="/api/search/v2.1/amgvideo/filterbrowse?entitytype=movie&filter=editorialrating%3E8&filter=releaseyear%3E1500&&include=cast,images&size=1&facet=genre"></dataset> -->

    <class name="facet">
      <handler name="ondata" args="r">
        console.log('facet data', r);
      </handler>
      <boundslayout></boundslayout>
      <simplelayout spacing="1"></simplelayout>
      <replicator datapath="/count" classname="text"></replicator>
      <replicator datapath="/name" classname="text"></replicator>
    </class>

    <simplelayout attribute="y" axis="height" spacing="1"></simplelayout>
<!--     <replicator datapath="$movies/searchResponse/facetCounts[0]/facetCount[*]" classname="facet">
      <handler name="ondata" args="r">
        console.log('replicator data', r, this, this.parent);
      </handler>
    </replicator> -->
  </view>

</body>
</html>