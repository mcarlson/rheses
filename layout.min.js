(function(){var hackstyle,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};hackstyle=function(){var origstyle,stylemap,styletap;stylemap={left:"x",top:"y","background-color":"bgcolor"};origstyle=$.style;styletap=function(elem,name,value){var returnval,view;returnval=origstyle.apply(this,arguments);name=stylemap[name]||name;view=elem.$view;if(view[name]!==value){view.setAttribute(name,value,true)}return returnval};return function(active){if(active){return $.style=styletap}else{return $.style=origstyle}}}();window.lz=function(){var Class,Clickable,Eventable,Events,Idle,Keyboard,Layout,Mixin,Module,Mouse,Node,Sprite,StartEventable,View,Window,compiler,constraintScopes,dom,exports,idle,ignoredAttributes,mixOf,moduleKeywords,mouseEvents,_initConstraints;mixOf=function(){var Mixed,base,i,method,mixin,mixins,name,_i,_ref;base=arguments[0],mixins=2<=arguments.length?__slice.call(arguments,1):[];Mixed=function(_super){__extends(Mixed,_super);function Mixed(){return Mixed.__super__.constructor.apply(this,arguments)}return Mixed}(base);for(i=_i=mixins.length-1;_i>=0;i=_i+=-1){mixin=mixins[i];_ref=mixin.prototype;for(name in _ref){method=_ref[name];Mixed.prototype[name]=method}}return Mixed};Events={bind:function(ev,callback){var evs,name,_base,_i,_len;evs=ev.split(" ");if(!(this.hasOwnProperty("events")&&this.events)){this.events={}}for(_i=0,_len=evs.length;_i<_len;_i++){name=evs[_i];(_base=this.events)[name]||(_base[name]=[]);this.events[name].push(callback)}return this},one:function(ev,callback){return this.bind(ev,function(){this.unbind(ev,arguments.callee);return callback.apply(this,arguments)})},trigger:function(){var args,callback,ev,list,_i,_len,_ref;args=1<=arguments.length?__slice.call(arguments,0):[];ev=args.shift();list=this.hasOwnProperty("events")&&((_ref=this.events)!=null?_ref[ev]:void 0);if(!list){return}for(_i=0,_len=list.length;_i<_len;_i++){callback=list[_i];if(callback.apply(this,args)===false){break}}return true},listenTo:function(obj,ev,callback){obj.bind(ev,callback);this.listeningTo||(this.listeningTo=[]);this.listeningTo.push({obj:obj,ev:ev,callback:callback});return this},listenToOnce:function(obj,ev,callback){var listeningToOnce;listeningToOnce=this.listeningToOnce||(this.listeningToOnce=[]);listeningToOnce.push(obj);obj.one(ev,function(){var idx;idx=listeningToOnce.indexOf(obj);if(idx!==-1){listeningToOnce.splice(idx,1)}return callback.apply(this,arguments)});return this},stopListening:function(obj,ev,callback){var idx,listeningTo,_i,_j,_len,_len1,_ref,_ref1,_ref2,_results;if(obj){obj.unbind(ev,callback);_ref=[this.listeningTo,this.listeningToOnce];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){listeningTo=_ref[_i];if(!listeningTo){continue}idx=listeningTo.indexOf(obj);if(idx!==-1){_results.push(listeningTo.splice(idx,1))}else{_results.push(void 0)}}return _results}else{_ref1=this.listeningTo;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){_ref2=_ref1[_j],obj=_ref2.obj,ev=_ref2.ev,callback=_ref2.callback;obj.unbind(ev,callback)}return this.listeningTo=void 0}},unbind:function(ev,callback){var cb,evs,i,list,name,_i,_j,_len,_len1,_ref;if(!ev){this.events={};return this}evs=ev.split(" ");for(_i=0,_len=evs.length;_i<_len;_i++){name=evs[_i];list=(_ref=this.events)!=null?_ref[name]:void 0;if(!list){continue}if(!callback){delete this.events[name];continue}for(i=_j=0,_len1=list.length;_j<_len1;i=++_j){cb=list[i];if(!(cb===callback)){continue}list=list.slice();list.splice(i,1);this.events[name]=list;break}}return this}};Events.on=Events.bind;Events.off=Events.unbind;moduleKeywords=["included","extended"];Module=function(){function Module(){}Module.include=function(obj){var key,value,_ref;if(!obj){throw new Error("include(obj) requires obj")}for(key in obj){value=obj[key];if(__indexOf.call(moduleKeywords,key)<0){this.prototype[key]=value}}if((_ref=obj.included)!=null){_ref.call(this,obj)}return this};return Module}();Eventable=function(_super){var typemappings;__extends(Eventable,_super);function Eventable(){return Eventable.__super__.constructor.apply(this,arguments)}Eventable.include(Events);typemappings={number:parseFloat,"boolean":function(val){if(typeof val==="string"){return val==="true"}else{return!!val}},string:function(val){return val+""},json:function(val){return JSON.parse(val)},expression:function(val){if(typeof val!=="string"){return val}return eval(val)}};Eventable.prototype.setAttribute=function(name,value){var type,_name;type=this.types[name];if(type){value=typemappings[type](value)}if(typeof this[_name="set_"+name]==="function"){this[_name](value)}if(this[name]!==value){this[name]=value}return this.sendEvent(name,value)};Eventable.prototype.sendEvent=function(name,value){var _ref;if((_ref=this.events)!=null?_ref[name]:void 0){this.trigger(name,value,this)}return this};Eventable.prototype.set=function(attributes){var name,value;for(name in attributes){value=attributes[name];this.setAttribute(name,value)}return this};return Eventable}(Module);compiler=function(){var cacheKey,compile,compileCache,debug,exports,findBindings,scriptCache,strict,transform,usecache;usecache=window.location.search.indexOf("nocache")===-1;debug=window.location.search.indexOf("debug")>0;strict=window.location.search.indexOf("strict")>0;cacheKey="compilecache";if(usecache&&cacheKey in localStorage){compileCache=JSON.parse(localStorage[cacheKey])}else{compileCache={bindings:{},script:{coffee:{}}};localStorage[cacheKey]=JSON.stringify(compileCache)}$(window).on("unload",function(){return localStorage[cacheKey]=JSON.stringify(compileCache)});findBindings=function(){var bindingCache,propertyBindings,scopes;bindingCache=compileCache.bindings;scopes=null;propertyBindings={MemberExpression:function(n){var name;name=n.property.name;n=n.object;scopes.push({binding:acorn.stringify(n),property:name});return true}};return function(expression){var ast;if(usecache&&expression in bindingCache){return bindingCache[expression]}ast=acorn.parse(expression);scopes=[];acorn.walkDown(ast,propertyBindings);return bindingCache[expression]=scopes}}();transform=function(){var coffeeCache,compilers;coffeeCache=compileCache.script.coffee;compilers={coffee:function(script){if(usecache&&script in coffeeCache){return coffeeCache[script]}if(!window.CoffeeScript){console.warn("missing coffee-script.js include");return}if(script){return coffeeCache[script]=CoffeeScript.compile(script,{bare:true})}}};return function(script,name){if(script==null){script=""}if(!(name in compilers)){return script}return compilers[name](script)}}();scriptCache={};compile=function(script,args,name){var argstring,e,func,key;if(script==null){script=""}if(args==null){args=[]}if(name==null){name=""}argstring=args.join();key=script+argstring+name;if(key in scriptCache){return scriptCache[key]}try{if(debug&&name){if(strict){script='"use strict"\n'+script}func=new Function("return function "+name+"("+argstring+"){"+script+"}")()}else{func=new Function(args,script)}return scriptCache[key]=func}catch(_error){e=_error;return console.error("failed to compile",e.toString(),args,script)}};return exports={compile:compile,transform:transform,findBindings:findBindings}}();constraintScopes=[];_initConstraints=function(){var constraint,_i,_len;for(_i=0,_len=constraintScopes.length;_i<_len;_i++){constraint=constraintScopes[_i];constraint._bindConstraints()}return constraintScopes=[]};Node=function(_super){var matchConstraint,_eventCallback,_installMethod;__extends(Node,_super);matchConstraint=/\${(.+)}/;function Node(el,attributes){var args,callback,constraint,method,methodspec,nam,name,par,reference,script,value,_i,_len,_ref,_ref1,_ref2,_ref3;if(attributes==null){attributes={}}this.subnodes=[];this.types=(_ref=attributes.$types)!=null?_ref:{};delete attributes.$types;if(el!=null?el.textContent:void 0){attributes.textcontent=el.textContent}if(attributes.$methods){_ref1=attributes.$methods;for(name in _ref1){methodspec=_ref1[name];_installMethod(this,name,compiler.compile(methodspec[0],methodspec[1],""+attributes.$tagname+"$"+name).bind(this),methodspec[2])}delete attributes.$methods}if(attributes.$handlers){_ref2=attributes.$handlers;for(_i=0,_len=_ref2.length;_i<_len;_i++){_ref3=_ref2[_i],name=_ref3.name,script=_ref3.script,args=_ref3.args,reference=_ref3.reference,method=_ref3.method;name=name.substr(2);if(method){callback=this[method]}else{callback=_eventCallback(name,script,this,attributes.$tagname,args)}if(reference!=null){this.listenTo(eval(reference),name,callback)}else{this.bind(name,callback)}if(__indexOf.call(mouseEvents,name)>=0){if(attributes.clickable!=="false"){attributes.clickable=true}}}delete attributes.$handlers}if(attributes.parent){par=attributes.parent;delete attributes.parent}if(attributes.name){nam=attributes.name;delete attributes.name}for(name in attributes){value=attributes[name];constraint=typeof value.match==="function"?value.match(matchConstraint):void 0;if(constraint){this.applyConstraint(name,constraint[1])}else if(name.indexOf("on")===0){name=name.substr(2);this.bind(name,_eventCallback(name,value,this,attributes.$tagname))}else{this.setAttribute(name,value)}}if(this.constraints){constraintScopes.push(this)}if(par){this.setAttribute("parent",par)}if(nam){this.setAttribute("name",nam)}this.sendEvent("init",this)}Node.prototype.initConstraints=function(){_initConstraints();return this};_eventCallback=function(name,script,scope,tagname,fnargs){var js;if(tagname==null){tagname=""}if(fnargs==null){fnargs=["value"]}js=compiler.compile(script,fnargs,""+tagname+"$on"+name);return function(){var args;if(name in scope){args=[scope[name]]}else{args=arguments}return js.apply(scope,args)}};_installMethod=function(scope,methodname,method,classmethod){var meth,supr;if(methodname in scope){supr=scope[methodname];meth=method;return scope[methodname]=function(){supr.apply(scope,arguments);return meth.apply(scope,arguments)}}else{return scope[methodname]=method}};Node.prototype.applyConstraint=function(property,expression){var bindexpression,bindings,scope,scopes,_i,_len;if(this.constraints==null){this.constraints={}}this.constraints[property]={expression:"return "+expression,bindings:{}};bindings=this.constraints[property].bindings;scopes=compiler.findBindings(expression);for(_i=0,_len=scopes.length;_i<_len;_i++){scope=scopes[_i];bindexpression=scope.binding;if(bindings[bindexpression]==null){bindings[bindexpression]=[]}bindings[bindexpression].push(scope)}};Node.prototype._bindConstraints=function(){var bindexpression,binding,bindinglist,bindings,boundref,constraint,expression,fn,name,property,_i,_len,_ref;_ref=this.constraints;for(name in _ref){constraint=_ref[name];bindings=constraint.bindings,expression=constraint.expression;fn=compiler.compile(expression).bind(this);constraint=this._constraintCallback(name,fn);for(bindexpression in bindings){bindinglist=bindings[bindexpression];boundref=compiler.compile("return "+bindexpression).bind(this)();if(boundref==null){boundref=boundref.$view}for(_i=0,_len=bindinglist.length;_i<_len;_i++){binding=bindinglist[_i];property=binding.property;if(typeof boundref.bind==="function"){boundref.bind(property,constraint)}}}this.setAttribute(name,fn())}};Node.prototype._constraintCallback=function(name,fn){return function constraintCallback(){this.setAttribute(name,fn());return}.bind(this)};Node.prototype.set_parent=function(parent){if(parent instanceof Node){if(this.name){parent[this.name]=this}parent.subnodes.push(this);return parent.sendEvent("subnodes",this)}};Node.prototype.set_name=function(name){return this.parent[name]=this};Node.prototype.set_id=function(id){return window[id]=this};Node.prototype._removeFromParent=function(name){var arr,index;if(!this.parent){return}arr=this.parent[name];index=arr.indexOf(this);if(index!==-1){arr.splice(index,1);this.parent.sendEvent(name,arr[index])}};Node.prototype._findInParents=function(name){var p;p=this.parent;while(p){if(name in p){return p[name]}p=p.parent}};Node.prototype.destroy=function(skipevents){var subnode,_i,_len,_ref,_ref1;this.sendEvent("destroy",this);if(this.listeningTo){this.stopListening()}this.unbind();if(((_ref=this.parent)!=null?_ref[this.name]:void 0)===this){delete this.parent[this.name]}_ref1=this.subnodes;for(_i=0,_len=_ref1.length;_i<_len;_i++){subnode=_ref1[_i];if(subnode!=null){subnode.destroy(true)}}if(!skipevents){return this._removeFromParent("subnodes")}};return Node}(Eventable);Sprite=function(){var capabilities,fcamelCase,noop,rdashAlpha,stylemap;noop=function(){};stylemap={x:"left",y:"top",bgcolor:"backgroundColor"};fcamelCase=function(all,letter){return letter.toUpperCase()};rdashAlpha=/-([\da-z])/gi;capabilities={touch:"ontouchstart"in window||"onmsgesturechange"in window};function Sprite(jqel,view,tagname){if(tagname==null){tagname="div"}this.handle=__bind(this.handle,this);this.animate=__bind(this.animate,this);if(jqel==null){this.el=document.createElement(tagname);this.el.$init=true}else if(jqel instanceof HTMLElement){this.el=jqel}this.el.$view=view;this.el.setAttribute("class","sprite")}Sprite.prototype.setStyle=function(name,value){if(value==null){value=""}if(name in stylemap){name=stylemap[name]}else if(name.match(rdashAlpha)){name=name.replace(rdashAlpha,fcamelCase)}return this.el.style[name]=value};Sprite.prototype.set_parent=function(parent){if(parent instanceof Sprite){parent=parent.el}return parent.appendChild(this.el)};Sprite.prototype.set_id=function(id){return this.el.setAttribute("id",id)};Sprite.prototype.animate=function(){if(this.jqel==null){this.jqel=$(this.el)}return this.jqel.animate.apply(this.jqel,arguments)};Sprite.prototype.set_clickable=function(clickable){this.setStyle("pointer-events",clickable?"auto":"none");if(capabilities.touch){return this.el.onclick=noop}};Sprite.prototype.destroy=function(){this.el.parentNode.removeChild(this.el);return this.el=this.jqel=null};Sprite.prototype.set_clip=function(clip){return this.setStyle("overflow",clip?"hidden":"")};Sprite.prototype.text=function(text){if(text!=null){return this.el.innerHTML=text}else{return this.el.innerHTML}};Sprite.prototype.value=function(value){if(!this.input){return}if(value!=null){return this.input.value=value}else{return this.input.value}};Sprite.prototype.measureTextSize=function(multiline,width){this.el.setAttribute("class","sprite sprite-text");if(multiline){this.setStyle("width",width);this.setStyle("whiteSpace","normal")}else{this.setStyle("width","auto")}return{width:this.el.clientWidth,height:this.el.clientHeight}};Sprite.prototype.handle=function(event){var view;view=event.target.$view;if(!view){return}return view.sendEvent(event.type,view)};Sprite.prototype.createInputtextElement=function(text,multiline,width){var input;input=document.createElement("input");input.setAttribute("type","text");input.setAttribute("value",text);input.setAttribute("style","border: none; outline: none; background-color:transparent;");this.el.appendChild(input);return setTimeout(function(_this){return function(){if(!_this.el){return}_this.input=_this.el.getElementsByTagName("input")[0];_this.input.$view=_this.el.$view;return $(input).on("focus blur",_this.handle)}}(this),0)};Sprite.prototype.getAbsolute=function(){var pos;if(this.jqel==null){this.jqel=$(this.el)}pos=this.jqel.position();return{x:pos.left,y:pos.top}};Sprite.prototype.set_class=function(classname){return this.el.setAttribute("class",classname)};return Sprite}();Clickable=function(){function Clickable(){}Clickable.prototype.set_clickable=function(clickable){return this.sprite.set_clickable(clickable)};return Clickable}();Mixin=function(){function Mixin(el,attributes){console.log("Mixin",el,attributes)}return Mixin}();ignoredAttributes={parent:true,id:true,name:true,"extends":true,type:true,scriptincludes:true};View=function(_super){__extends(View,_super);function View(el,attributes){var key,type,types,_ref;if(attributes==null){attributes={}}this.subviews=[];types={x:"number",y:"number",width:"number",height:"number",clickable:"boolean",clip:"boolean",visible:"boolean"};for(key in types){type=types[key];if(!(key in attributes)){this[key]=type==="number"?0:false}}_ref=attributes.$types;for(key in _ref){type=_ref[key];types[key]=type}attributes.$types=types;attributes.visible=true;if(el instanceof View){el=el.sprite}this.sprite=new Sprite(el,this,attributes.$tagname);View.__super__.constructor.apply(this,arguments)}View.prototype.setAttribute=function(name,value,skip){if(!(skip||name in ignoredAttributes||this[name]===value)){this.sprite.setStyle(name,value)}return View.__super__.setAttribute.apply(this,arguments)};View.prototype.set_parent=function(parent){View.__super__.set_parent.apply(this,arguments);if(parent instanceof View){parent.subviews.push(this);parent.sendEvent("subviews",this);parent=parent.sprite}return this.sprite.set_parent(parent)};View.prototype.set_id=function(id){View.__super__.set_id.apply(this,arguments);return this.sprite.set_id(id)};View.prototype.animate=function(){return this.sprite.animate.apply(this,arguments)};View.prototype.set_clip=function(clip){return this.sprite.set_clip(clip)};View.prototype.destroy=function(skipevents){View.__super__.destroy.apply(this,arguments);if(!skipevents){this._removeFromParent("subviews")}this.sprite.destroy();return this.sprite=null};View.prototype.getAbsolute=function(){return this.sprite.getAbsolute()};View.prototype.set_class=function(classname){return this.sprite.set_class(classname)};return View}(mixOf(Node,Clickable));dom=function(){var builtinTags,exports,findAutoIncludes,flattenattributes,htmlDecode,initAllElements,initElement,initFromElement,processSpecialTags,specialtags,writeCSS;flattenattributes=function(namednodemap){var attributes,i,_i,_len;attributes={};for(_i=0,_len=namednodemap.length;_i<_len;_i++){i=namednodemap[_i];attributes[i.name]=i.value}return attributes};initFromElement=function(el){el.style.display="none";return findAutoIncludes(el,function(){el.style.display=null;initElement(el);return _initConstraints()})};findAutoIncludes=function(parentel,callback){var includedScripts,includerequests,inlineclasses,jel,jqel,loadLZX,loadScript,loadqueue,lzxloaded,lzxrequests,scriptloading,_i,_len,_ref;jqel=$(parentel);includerequests=[];includedScripts={};loadqueue=[];scriptloading=false;loadScript=function(url,cb){var appendScript,appendcallback;if(url in includedScripts){return}includedScripts[url]=true;if(scriptloading){loadqueue.push(url);return url}appendScript=function(url,cb){var script;scriptloading=url;script=document.createElement("script");script.type="text/javascript";$("head").append(script);script.onload=cb;script.onerror=function(){console.error("failed to load scriptinclude",url);return cb()};return script.src=url};appendcallback=function(){scriptloading=false;if(loadqueue.length===0){return cb()}else{return appendScript(loadqueue.shift(),appendcallback)}};return appendScript(url,appendcallback)};inlineclasses={};lzxrequests=[];lzxloaded={};loadLZX=function(name,el){var prom,url;if(name in lz||name in lzxloaded||__indexOf.call(specialtags,name)>=0||name in inlineclasses||__indexOf.call(builtinTags,name)>=0){return}lzxloaded[name]=true;url="classes/"+name+".lzx";prom=$.get(url);prom.url=url;prom.el=el;return lzxrequests.push(prom)};_ref=jqel.find("include");for(_i=0,_len=_ref.length;_i<_len;_i++){jel=_ref[_i];includerequests.push($.get(jel.attributes.href.value))}return $.when.apply($,includerequests).done(function(){var args,el,html,includeRE,name,xhr,_j,_k,_len1,_len2,_ref1;args=1<=arguments.length?__slice.call(arguments,0):[];if(includerequests.length===1){args=[args]}includeRE=/<[\/]*library>/gi;for(_j=0,_len1=args.length;_j<_len1;_j++){xhr=args[_j];html=xhr[0].replace(includeRE,"");jqel.prepend(html)}_ref1=jqel.find("*");for(_k=0,_len2=_ref1.length;_k<_len2;_k++){el=_ref1[_k];name=el.localName;if(name==="class"){if(el.attributes["extends"]){loadLZX(el.attributes["extends"].value,el)}inlineclasses[el.attributes.name.value]=true}else{loadLZX(name,el)}}return $.when.apply($,lzxrequests).done(function(){var args,scriptsloading,url,_l,_len3,_len4,_len5,_m,_n,_ref2,_ref3;args=1<=arguments.length?__slice.call(arguments,0):[];if(lzxrequests.length===1){args=[args]}for(_l=0,_len3=args.length;_l<_len3;_l++){xhr=args[_l];jqel.prepend(xhr[0])}scriptsloading=false;_ref2=jqel.find("[scriptincludes]");for(_m=0,_len4=_ref2.length;_m<_len4;_m++){el=_ref2[_m];_ref3=el.attributes.scriptincludes.value.split(",");for(_n=0,_len5=_ref3.length;_n<_len5;_n++){url=_ref3[_n];scriptsloading=loadScript(url,callback)}}if(!scriptsloading){return callback()}}).fail(function(){var args,_l,_len3,_results;args=1<=arguments.length?__slice.call(arguments,0):[];if(args.length===1){args=[args]}_results=[];for(_l=0,_len3=args.length;_l<_len3;_l++){xhr=args[_l];_results.push(console.error("failed to load",xhr.url,"for element",xhr.el))}return _results})})};specialtags=["handler","method","attribute","setter","include","library"];builtinTags=["input","div","img","script","canvas"];initElement=function(el,parent){var attributes,child,children,event,eventname,tagname,_i,_j,_len,_len1,_ref;if(el.$init){return}el.$init=true;tagname=el.localName;if(!(tagname in lz)){if(__indexOf.call(builtinTags,tagname)<0){console.warn("could not find class for tag",tagname,el)}return}attributes=flattenattributes(el.attributes);attributes.$tagname=tagname;for(_i=0,_len=mouseEvents.length;_i<_len;_i++){event=mouseEvents[_i];eventname="on"+event;if(eventname in attributes){if(attributes.clickable!==false){attributes.clickable=true}el.removeAttribute(eventname)}}if(parent==null){parent=el.parentNode}if(parent!=null){attributes.parent=parent}if(tagname!=="class"){dom.processSpecialTags(el,attributes,attributes.type)}parent=new lz[tagname](el,attributes);if(tagname!=="class"){children=function(){var _j,_len1,_ref,_results;_ref=el.childNodes;_results=[];for(_j=0,_len1=_ref.length;_j<_len1;_j++){child=_ref[_j];if(child.nodeType===1){_results.push(child)}}return _results}();for(_j=0,_len1=children.length;_j<_len1;_j++){child=children[_j];if(_ref=child.localName,__indexOf.call(specialtags,_ref)<0){initElement(child,parent)}}}};writeCSS=function(){var style;style=document.createElement("style");style.type="text/css";style.innerHTML=".sprite{ position: absolute; pointer-events: none; padding: 0; margin: 0;} .sprite-text{ width: auto; height; auto; white-space: nowrap;  padding: 0; margin: 0;} .hidden{ display: none; } method { display: none; } handler { display: none; } setter { display: none; } class { display:none } node { display:none }";return document.getElementsByTagName("head")[0].appendChild(style)};initAllElements=function(selector){var el,_i,_len,_results;if(selector==null){selector=$("view").not("view view")}_results=[];for(_i=0,_len=selector.length;_i<_len;_i++){el=selector[_i];_results.push(initFromElement(el))}return _results};htmlDecode=function(input){var e,_ref;e=document.createElement("div");e.innerHTML=input;return(_ref=e.childNodes[0])!=null?_ref.nodeValue:void 0};processSpecialTags=function(el,classattributes,defaulttype){var allocation,args,attributes,child,children,handler,script,type,_i,_len,_ref,_ref1,_ref2,_ref3;if(classattributes.$types==null){classattributes.$types={}}if(classattributes.$methods==null){classattributes.$methods={}}if(classattributes.$handlers==null){classattributes.$handlers=[]}children=function(){var _i,_len,_ref,_ref1,_results;_ref=el.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];if(child.nodeType===1&&(_ref1=child.localName,__indexOf.call(specialtags,_ref1)>=0)){_results.push(child)}}return _results}();for(_i=0,_len=children.length;_i<_len;_i++){child=children[_i];attributes=flattenattributes(child.attributes);switch(child.localName){case"handler":args=((_ref=attributes.args)!=null?_ref:"").split();script=htmlDecode(child.innerHTML);type=(_ref1=attributes.type)!=null?_ref1:defaulttype;handler={name:attributes.name,script:compiler.transform(script,type),args:args,reference:attributes.reference,method:attributes.method};classattributes.$handlers.push(handler);break;case"method":args=((_ref2=attributes.args)!=null?_ref2:"").split();script=htmlDecode(child.innerHTML);type=attributes.type||defaulttype;allocation=attributes.allocation;classattributes.$methods[attributes.name]=[compiler.transform(script,type),args,allocation];break;case"setter":args=((_ref3=attributes.args)!=null?_ref3:"").split();script=htmlDecode(child.innerHTML);type=attributes.type||defaulttype;classattributes.$methods["set_"+attributes.name]=[compiler.transform(script,type),args];break;case"attribute":classattributes[attributes.name]=attributes.value;classattributes.$types[attributes.name]=attributes.type}}return children};return exports={initAllElements:initAllElements,initElement:initElement,processSpecialTags:processSpecialTags,writeCSS:writeCSS}}();Class=function(){var clone;clone=function(obj){var name,newobj,val;newobj={};for(name in obj){val=obj[name];newobj[name]=val}return newobj};function Class(el,classattributes){var child,compilertype,extend,ignored,instancebody,name,oldbody,processedChildren,_i,_len;if(classattributes==null){classattributes={}}name=classattributes.name;extend=classattributes["extends"]!=null?classattributes["extends"]:classattributes["extends"]="view";compilertype=classattributes.type;for(ignored in ignoredAttributes){delete classattributes[ignored]}processedChildren=dom.processSpecialTags(el,classattributes,compilertype);oldbody=el.innerHTML.trim();for(_i=0,_len=processedChildren.length;_i<_len;_i++){child=processedChildren[_i];child.parentNode.removeChild(child)}instancebody=el.innerHTML.trim();if(oldbody){el.innerHTML=oldbody}if(name in lz){console.warn("overwriting class",name)}lz[name]=function(instanceel,instanceattributes){var attributes,children,key,parent,propname,val,value,viewel,_j,_len1,_ref;attributes=clone(classattributes);for(key in instanceattributes){value=instanceattributes[key];if((key==="$methods"||key==="$types")&&key in attributes){attributes[key]=clone(attributes[key]);for(propname in value){val=value[propname];attributes[key][propname]=val}}else if(key==="$handlers"&&key in attributes){attributes[key]=attributes[key].concat(value)}else{attributes[key]=value}}if(!(extend in lz)){console.warn("could not find class for tag",extend);return}if(attributes.$tagname==="class"||!attributes.$tagname){attributes.$tagname=name}parent=new lz[extend](instanceel,attributes);viewel=(_ref=parent.sprite)!=null?_ref.el:void 0;if(instanceel){if(!viewel){instanceel.setAttribute("class","hidden")}}if(instancebody&&viewel){if(viewel.innerHTML){viewel.innerHTML=instancebody+viewel.innerHTML}else{viewel.innerHTML=instancebody}children=function(){var _j,_len1,_ref1,_results;_ref1=viewel.childNodes;_results=[];for(_j=0,_len1=_ref1.length;_j<_len1;_j++){child=_ref1[_j];if(child.nodeType===1){_results.push(child)}}return _results}();for(_j=0,_len1=children.length;_j<_len1;_j++){child=children[_j];dom.initElement(child,parent)}}return parent}}return Class}();Layout=function(_super){__extends(Layout,_super);function Layout(el,attributes){var subview,subviews,_base,_i,_len;if(attributes==null){attributes={}}this.update=__bind(this.update,this);this.added=__bind(this.added,this);this.locked=true;Layout.__super__.constructor.apply(this,arguments);this.listenTo(this.parent,"subviews",this.added);if((_base=this.parent).layouts==null){_base.layouts=[]}this.parent.layouts.push(this);subviews=this.parent.subviews;if(subviews){for(_i=0,_len=subviews.length;_i<_len;_i++){subview=subviews[_i];this.added(subview)}}this.locked=false;this.update()}Layout.prototype.added=function(child){if(child){if(!child.ignorelayout){this.sendEvent("subview",child)}}return this.update(null,child)};Layout.prototype.update=function(value,sender){};Layout.prototype.skip=function(){var _ref;if(this.locked||!((_ref=this.parent)!=null?_ref.subviews:void 0)||this.parent.subviews.length===0){return true}};Layout.prototype.destroy=function(skipevents){this.locked=true;Layout.__super__.destroy.apply(this,arguments);if(!skipevents){return this._removeFromParent("layouts")}};Layout.prototype.set_locked=function(locked){var changed;changed=this.locked!==locked;this.locked=locked;this.sendEvent("locked",locked);if(changed&&!locked){return this.update()}};return Layout}(Node);idle=function(){var doTick,requestAnimationFrame,tickEvents,ticking;requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;ticking=false;tickEvents=[];doTick=function(time){var key;for(key in tickEvents){if(tickEvents[key]){tickEvents[key](time);tickEvents[key]=null}}return ticking=false};return function(key,callback){if(!ticking){requestAnimationFrame(doTick)}ticking=true;return tickEvents[key]=callback}}();StartEventable=function(_super){__extends(StartEventable,_super);function StartEventable(){this.stopEvent=__bind(this.stopEvent,this);this.startEvent=__bind(this.startEvent,this);return StartEventable.__super__.constructor.apply(this,arguments)}StartEventable.prototype.bind=function(ev,callback){StartEventable.__super__.bind.apply(this,arguments);if(this.startEventTest()){return this.startEvent()}};StartEventable.prototype.unbind=function(ev,callback){StartEventable.__super__.unbind.apply(this,arguments);if(!this.startEventTest()){return this.stopEvent()}};StartEventable.prototype.startEvent=function(event){if(this.eventStarted){return}return this.eventStarted=true};StartEventable.prototype.stopEvent=function(event){if(!this.eventStarted){return}return this.eventStarted=false};return StartEventable}(Eventable);Idle=function(_super){__extends(Idle,_super);function Idle(){this.sender=__bind(this.sender,this);this.startEvent=__bind(this.startEvent,this);return Idle.__super__.constructor.apply(this,arguments)}Idle.prototype.startEventTest=function(){var start,_ref;start=(_ref=this.events["idle"])!=null?_ref.length:void 0;if(start){return start}};Idle.prototype.startEvent=function(event){Idle.__super__.startEvent.apply(this,arguments);return idle(1,this.sender)};Idle.prototype.sender=function(time){this.sendEvent("idle",time);return setTimeout(function(_this){return function(){return idle(1,_this.sender)}}(this),0)};return Idle}(StartEventable);mouseEvents=["click","mouseover","mouseout","mousedown","mouseup"];Mouse=function(_super){__extends(Mouse,_super);function Mouse(){this.sender=__bind(this.sender,this);this.handle=__bind(this.handle,this);this.x=0;this.y=0;this.docSelector=$(document);this.docSelector.on(mouseEvents.join(" "),this.handle);this.docSelector.on("mousemove",this.handle).one("mouseout",this.stopEvent)}Mouse.prototype.startEventTest=function(){var _ref,_ref1,_ref2;return((_ref=this.events["mousemove"])!=null?_ref.length:void 0)||((_ref1=this.events["x"])!=null?_ref1.length:void 0)||((_ref2=this.events["y"])!=null?_ref2.length:void 0)};Mouse.prototype.handle=function(event){var type,view;view=event.target.$view;type=event.type;if(view){view.sendEvent(type,view)}if(this.eventStarted&&type==="mousemove"){this.x=event.pageX;this.y=event.pageY;return idle(0,this.sender)}else{return this.sendEvent(type,view)}};Mouse.prototype.sender=function(){this.sendEvent("mousemove",{x:this.x,y:this.y});this.sendEvent("x",this.x);return this.sendEvent("y",this.y)};Mouse.prototype.handleDocEvent=function(event){if(event&&event.target!==document){return}if(this.eventStarted){return this.docSelector.on("mousemove",this.handle).one("mouseout",this.stopEvent)}else{return this.docSelector.on("mousemove",this.handle).one("mouseout",this.startEvent)}};return Mouse}(StartEventable);Window=function(_super){__extends(Window,_super);
function Window(){this.handle=__bind(this.handle,this);var handleVisibilityChange,hidden,visibilityChange;window.addEventListener("resize",this.handle,false);this.visible=true;if(document.hidden!=null){hidden="hidden";visibilityChange="visibilitychange"}else if(document.mozHidden!=null){hidden="mozHidden";visibilityChange="mozvisibilitychange"}else if(document.msHidden!=null){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(document.webkitHidden!=null){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"}handleVisibilityChange=function(_this){return function(){_this.visible=document[hidden];console.log("visibilitychange",_this.visible);return _this.sendEvent("visible",_this.visible)}}(this);document.addEventListener(visibilityChange,handleVisibilityChange,false);this.handle()}Window.prototype.startEventTest=function(){var _ref,_ref1;return((_ref=this.events["width"])!=null?_ref.length:void 0)||((_ref1=this.events["height"])!=null?_ref1.length:void 0)};Window.prototype.handle=function(event){this.width=window.innerWidth;this.sendEvent("width",this.width);this.height=window.innerHeight;return this.sendEvent("height",this.height)};return Window}(StartEventable);Keyboard=function(_super){var keyboardEvents,keys;__extends(Keyboard,_super);keyboardEvents=["select","keyup","keydown","change"];keys={shiftKey:false,altKey:false,ctrlKey:false,metaKey:false,keyCode:0};function Keyboard(){this.handle=__bind(this.handle,this);$(document).on(keyboardEvents.join(" "),this.handle)}Keyboard.prototype.handle=function(event){var inputtext,key,type,value;inputtext=event.target.$view;type=event.type;for(key in keys){value=keys[key];keys[key]=event[key]}keys.type=type;if(inputtext){inputtext.sendEvent(type,keys);if(type==="keydown"||type==="keyup"||type==="blur"||type==="change"){value=event.target.value;if(inputtext.text!==value){inputtext.text=value;inputtext.sendEvent("text",value)}}}return this.sendEvent(type,keys)};return Keyboard}(Eventable);return exports={view:View,"class":Class,node:Node,mouse:new Mouse,keyboard:new Keyboard,window:new Window,layout:Layout,idle:new Idle,initElements:dom.initAllElements,writeCSS:dom.writeCSS}}();dr.writeCSS();$(window).on("load",function(){dr.initElements();return hackstyle(true)})}).call(this);